@{;
ViewBag.Title = "表单页面";
Layout = "~/Views/Shared/_Form.cshtml";
}
<link href="~/Content/scripts/plugins/jqgrid/jqgrid.css" rel="stylesheet" />
<link href="~/content/scripts/plugins/dialog/dialog.css" rel="stylesheet" />
<script src="~/Content/scripts/plugins/layout/jquery.layout.js"></script>
<script src="~/Content/scripts/business/Common.js" type="text/javascript"></script>
<script src="~/Content/scripts/plugins/jqgrid/grid.locale-cn.js"></script>
<script src="~/Content/scripts/plugins/jqgrid/jqgrid.min.js"></script>
<link href="~/content/scripts/plugins/icheck/skins/square/_all.css" type="text/css" rel="stylesheet" />
<script src="~/content/scripts/plugins/icheck/js/icheck.min.js" type="text/javascript"></script>
<script src="~/content/scripts/plugins/icheck/js/custom.min.js" type="text/javascript"></script>


<!--webUploader文件上传组件-->
<link href="~/content/scripts/plugins/webuploader/webuploader.css" rel="stylesheet" />
<link href="~/content/scripts/plugins/webuploader/webuploader-demo.css" rel="stylesheet" />
<script type="text/javascript" src="~/content/scripts/plugins/webuploader/webuploader.min.js"></script>
<script type="text/javascript" src="~/content/scripts/business/fileupload.js"></script>
<script>

    var currUserName = "@ERCHTMS.Code.OperatorProvider.Provider.Current().UserName";
    var currUserDeptName = "@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptName";
    var currUserID = "@ERCHTMS.Code.OperatorProvider.Provider.Current().UserId";
    var currUserDeptID = "@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptId";
    var NowTime = "@DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")";
    var roleNames = "@ERCHTMS.Code.OperatorProvider.Provider.Current().RoleName";
    var gxhs = "@(new ERCHTMS.Busines.SystemManage.DataItemDetailBLL().GetItemValue("广西华N版本"))";
    var hdkm = "@(new ERCHTMS.Busines.SystemManage.DataItemDetailBLL().GetItemValue("KMIndexUrl"))";

    var orgId = "";
    var flag = request('flag');
    if (flag == "proFiles")
        orgId = request('orgId');
    else orgId = top.currUserOrgId;
    var keyValue = request('keyValue');
    var mode = request('mode');

    var EditFlag = false;
    $(function () {
        if (gxhs == "" || gxhs == null || gxhs == "undefined") {
            $(".ProjectManager").hide();
            $("#ProjectManager").removeAttr("isvalid");
            $(".ProjectManagerTel").hide();
            $("#ProjectManagerTel").removeAttr("isvalid");
            $("#div8").hide();
        }
        else {
            $("#tr_ENGINEERWORKPEOPLE").html("工程作业人数");
            $("#tr_ENGINEERTECHPERSON").html("工程技术人数");
            $("#ENGINEERWORKPEOPLE").removeAttr("isvalid");
            $("#ENGINEERTECHPERSON").removeAttr("isvalid");
        }

        if (hdkm == "" || hdkm == null || hdkm == "undefined") {
            $("#div9").hide();
            $("#div10").hide();
            $("#div9 input").each(function (index, ele) {
                $(this).removeAttr("isvalid");
            });
            $("#div10 input").each(function (index, ele) {
                $(this).removeAttr("isvalid");
            });
        }

        if (mode == "Audit") {
            $("#tabAudit").show();
            LoadAuditList();
            $("#div_outEngineer input").attr("disabled", "disabled");
            $("#div_project input").attr("disabled", "disabled");
            $("#div_outEngineer textarea").attr("disabled", "disabled");
            $("#div_project textarea").attr("disabled", "disabled");
            $("#div_zzhi input").attr("disabled", "disabled");
            $("#ENGINEERNAME").attr("disabled", "disabled");
            $("#AuditEngineer").show();
            $("#btngroup").hide();
            $("#AUDITPEOPLE").val(currUserName);
            $("#AUDITPEOPLEID").val(currUserID);
            $("#AUDITDEPT").val(currUserDeptName);
            $("#AUDITDEPTID").val(currUserDeptID);
            $("#AUDITTIME").val(NowTime);
            $("#ZzzjAdd").attr("disabled", "disabled");
        } else if (mode == 'Add' || mode == "Edit") {
            $("#AuditEngineer").hide();
            $("#ZzzjAdd").attr("disabled", false);
            $("#btngroup").show();
            EditFlag = true;
        } else if (mode == "View") {
            $("#ZzzjAdd").attr("disabled", "disabled");
            $("#ENGINEERNAME").attr("disabled", "disabled");
            LoadAuditList();
            $("#tabAudit").hide();
            $("textarea").attr("disabled", "disabled");
            $("input").attr("disabled", "disabled")
            $("#btngroup").hide();
        }
        LoadCombobox();
        loadSendDept(orgId);
        initControl();
        GetZzzjGrid();
        $("input[name='isxk']").on('ifChecked', function (event) {
            var checkValue = $(this).val();
            if (checkValue == "1") {
                $("#SPLCERTIFICATE").attr("disabled", "disabled");
                $("#SPLCODE").attr("disabled", "disabled");
                $("#SPLCODE").attr("isvalid", "").attr("checkexpession", "");
                var font = $("#SPLCODE").parent().prev().find("font");
                if (font.length > 0) {
                    font.remove();
                }
                $("#SPLVALIDSTARTTIME").attr("disabled", "disabled");
                $("#SPLVALIDSTARTTIME").attr("isvalid", "").attr("checkexpession", "");
                var font = $("#SPLVALIDSTARTTIME").parent().prev().find("font");
                if (font.length > 0) {
                    font.remove();
                }
                $("#SPLVALIDENDTIME").attr("disabled", "disabled");
                $("#SPLVALIDENDTIME").attr("isvalid", "").attr("checkexpession", "");
                var font = $("#SPLVALIDENDTIME").parent().prev().find("font");
                if (!!font) {
                    font.remove();
                }
                $("#File2").find("input").attr("disabled", "disabled");
            }
            else {
                $("#SPLCERTIFICATE").attr("disabled", false);
                $("#SPLCODE").attr("disabled", false);
                $("#SPLCODE").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                $("#SPLCODE").parent().prev().append('<font face="宋体">*</font>');
                $("#SPLVALIDSTARTTIME").attr("disabled", false);
                $("#SPLVALIDSTARTTIME").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                $("#SPLVALIDSTARTTIME").parent().prev().append('<font face="宋体">*</font>');
                $("#SPLVALIDENDTIME").attr("disabled", false);
                $("#SPLVALIDENDTIME").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                $("#SPLVALIDENDTIME").parent().prev().append('<font face="宋体">*</font>');
                //$("#div_xk").show();
                $("#File2").find("input").attr("disabled", false);
            }
        });
        $("input[name='iszzzj']").on('ifChecked', function (event) {
            var checkValue = $(this).val();
            if (checkValue == "1") {
                $("#ZzzjAdd").attr("disabled", "disabled");
            }
            else {
                $("#ZzzjAdd").attr("disabled", false);
            }
        });
    });
    //绑定下拉框
    function LoadCombobox() {
        $("#ENGINEERTYPE").ComboBox({
            url: "../../SystemManage/DataItemDetail/GetDataItemListJson",
            param: { EnCode: "ProjectType" },
            id: "ItemValue",
            text: "ItemName",
            description: "==请选择==",
            height: "200px"
        })
        $("#ENGINEERLEVEL").ComboBox({
            url: "../../SystemManage/DataItemDetail/GetDataItemListJson",
            param: { EnCode: "ProjectLevel" },
            id: "ItemValue",
            text: "ItemName",
            description: "==请选择==",
            height: "200px"
        })
        $("#ENGINEERSTATE").ComboBox({
            url: "../../SystemManage/DataItemDetail/GetDataItemListJson",
            param: { EnCode: "OutProjectState" },
            id: "ItemValue",
            text: "ItemName",
            description: "==请选择==",
            height: "200px"
        })
        //$("#ENGINEERAREA").ComboBoxTree({
        //    url: "../../BaseManage/District/GetTreeJson",
        //    param: { orgID: orgId, areaIds: "", planId: "" },
        //    id: "DistrictID",
        //    text: "DistrictName",
        //    description: "==请选择==",
        //    height: "200px"
        //})
    }
    function LoadOutengineer() {
        $("#ENGINEERNAME").ComboBox({
            url: "../../OutsourcingProject/Outsouringengineer/GetEngineerDataByCurrdeptId?mode=001",
            id: "engineerid",
            text: "engineername",
            description: "==请选择==",
            height: "300px",
            allowSearch: true
        }).bind("change", function () {
            var value = $(this).attr("data-value");
            if (value == "") return;
            //ENGINEERNAME
            $("#ENGINEERNAME").val($(this).attr("data-text"));
            $("#OUTENGINEERID").val(value);
            $.SetForm({
                url: "../../OutsourcingProject/Outsouringengineer/GetEngineerEntity",
                param: { keyValue: $(this).attr('data-value') },
                success: function (data) {
                    $("#ENGINEERTYPE").ComboBoxSetValue(data.data.ENGINEERTYPE);
                    $("#ENGINEERLEVEL").ComboBoxSetValue(data.data.ENGINEERLEVEL);
                    $("#EngAreaName").val(data.data.EngAreaName);
                    $("#ENGINEERLETDEPTID").ComboBoxSetValue(data.data.ENGINEERLETDEPTID);
                    $("#ENGINEERLETDEPTID").trigger("change");
                    $("#OUTPROJECTID").ComboBoxSetValue(data.data.OUTPROJECTID);
                    $("#OUTPROJECTID").trigger("change");
                    $("#ENGINEERCODE").val(data.data.ENGINEERCODE);
                    $("#ENGINEERCONTENT").val(data.data.ENGINEERCONTENT);
                    $("#ENGINEERSCALE").val(data.data.ENGINEERSCALE);
                    $("#ENGINEERCASHDEPOSIT").val(data.data.ENGINEERCASHDEPOSIT);
                    $("#ENGINEERWORKPEOPLE").val(data.data.ENGINEERWORKPEOPLE);
                    $("#SAFEMANAGERPEOPLE").val(data.data.SAFEMANAGERPEOPLE);
                    $("#ENGINEERTECHPERSON").val(data.data.ENGINEERTECHPERSON);
                    $("#ENGINEERDIRECTOR").val(data.data.ENGINEERDIRECTOR);
                    $("#ENGINEERDIRECTORPHONE").val(data.data.ENGINEERDIRECTORPHONE);
                    $("#UnitSuper").val(data.data.UnitSuper);
                    $("#UnitSuperPhone").val(data.data.UnitSuperPhone);
                    $("#ProjectManager").val(data.data.ProjectManager);
                    $("#ProjectManagerTel").val(data.data.ProjectManagerTel);
                    $("#SafetyModerator").val(data.data.SafetyModerator);
                    $("#SafetyModeratorTel").val(data.data.SafetyModeratorTel);
                    if (mode == "Add") {
                        var proid = $("#OUTPROJECTID").attr('data-value');
                        $.SetForm({
                            url: "../../OutsourcingProject/Aptitudeinvestigateinfo/GetAptituInfoByOutProject",
                            param: { outProjectId: proid, keyValue: keyValue },
                            success: function (data) {
                                if (data != null) {
                                    $("#form1").formDeserialize(data);
                                    var queryJson = {
                                        InfoId: keyValue
                                    }
                                    $('#ZzzjgridTable').jqGrid('setGridParam', {
                                        postData: { queryJson: JSON.stringify(queryJson) }, page: 1
                                    }).trigger('reloadGrid');
                                    file_upload.bindFiles(EditFlag, false, keyValue + "10", 'uploader10', EditFlag);
                                    file_upload.bindFiles(EditFlag, false, keyValue + "09", 'uploader9', EditFlag);
                                    file_upload.bindFiles(EditFlag, false, keyValue + "08", 'uploader8', EditFlag);
                                    file_upload.bindFiles(EditFlag, false, keyValue + "07", 'uploader7', EditFlag);
                                    file_upload.bindFiles(EditFlag, false, keyValue + "06", 'uploader6', EditFlag);
                                    file_upload.bindFiles(EditFlag, false, keyValue + "05", 'uploader5', EditFlag);
                                    file_upload.bindFiles(EditFlag, false, keyValue + "04", 'uploader4', EditFlag);
                                    //file_upload.bindFiles(EditFlag, false, keyValue + "03", 'uploader3', EditFlag);
                                    file_upload.bindFiles(EditFlag, false, keyValue + "02", 'uploader2', EditFlag);
                                    file_upload.bindFiles(EditFlag, false, keyValue + "01", 'uploader1', EditFlag);
                                }
                            }
                        })
                    }
                }
            })
        })
    }
    //初始化控件
    function initControl() {
        LoadOutengineer();
        //获取表单
        if (!!keyValue) {
            LoadUpdateList();
            $.SetForm({
                url: "../../OutsourcingProject/Aptitudeinvestigateinfo/GetFormJson",
                param: { keyValue: keyValue },
                success: function (data) {
                    $("#form1").formDeserialize(data.data);
                    $("#ENGINEERNAME").ComboBoxSetValue(data.data.OUTENGINEERID);
                    $("#ENGINEERNAME").trigger("change");
                    $("#form1").formDeserialize(data.data);
                    file_upload.bindFiles(EditFlag, false, keyValue + "10", 'uploader10', EditFlag);
                    file_upload.bindFiles(EditFlag, false, keyValue + "09", 'uploader9', EditFlag);
                    file_upload.bindFiles(EditFlag, false, keyValue + "08", 'uploader8', EditFlag);
                    file_upload.bindFiles(EditFlag, false, keyValue + "07", 'uploader7', EditFlag);
                    file_upload.bindFiles(EditFlag, false, keyValue + "06", 'uploader6', EditFlag);
                    file_upload.bindFiles(EditFlag, false, keyValue + "05", 'uploader5', EditFlag);
                    file_upload.bindFiles(EditFlag, false, keyValue + "04", 'uploader4', EditFlag);
                    //file_upload.bindFiles(EditFlag, false, keyValue + "03", 'uploader3', EditFlag);
                    file_upload.bindFiles(EditFlag, false, keyValue + "02", 'uploader2', EditFlag);
                    file_upload.bindFiles(EditFlag, false, keyValue + "01", 'uploader1', EditFlag);
                    if (data.data.ISXK == "1") {
                        document.getElementById("isxk2").checked = true;
                        $("#SPLCERTIFICATE").attr("disabled", "disabled");
                        $("#SPLCODE").attr("disabled", "disabled");
                        $("#SPLCODE").attr("isvalid", "").attr("checkexpession", "");
                        var font = $("#SPLCODE").parent().prev().find("font");
                        if (font.length > 0) {
                            font.remove();
                        }
                        $("#SPLVALIDSTARTTIME").attr("disabled", "disabled");
                        $("#SPLVALIDSTARTTIME").attr("isvalid", "").attr("checkexpession", "");
                        var font = $("#SPLVALIDSTARTTIME").parent().prev().find("font");
                        if (font.length > 0) {
                            font.remove();
                        }
                        $("#SPLVALIDENDTIME").attr("disabled", "disabled");
                        $("#SPLVALIDENDTIME").attr("isvalid", "").attr("checkexpession", "");
                        var font = $("#SPLVALIDENDTIME").parent().prev().find("font");
                        if (!!font) {
                            font.remove();
                        }
                        $("#File2").find("input").attr("disabled", "disabled");
                    } else {
                        document.getElementById("isxk1").checked = true;
                        $("#SPLCERTIFICATE").attr("disabled", false);
                        $("#SPLCODE").attr("disabled", false);
                        $("#SPLCODE").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                        $("#SPLCODE").parent().prev().append('<font face="宋体">*</font>');
                        $("#SPLVALIDSTARTTIME").attr("disabled", false);
                        $("#SPLVALIDSTARTTIME").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                        $("#SPLVALIDSTARTTIME").parent().prev().append('<font face="宋体">*</font>');
                        $("#SPLVALIDENDTIME").attr("disabled", false);
                        $("#SPLVALIDENDTIME").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                        $("#SPLVALIDENDTIME").parent().prev().append('<font face="宋体">*</font>');
                        //$("#div_xk").show();
                        $("#File2").find("input").attr("disabled", false);
                    }
                    if (data.data.ISZZZJ == "1") {
                        document.getElementById("iszzzj2").checked = true;
                        //$("#CQORG").attr("disabled", "disabled");
                        //$("#CQCODE").attr("disabled", "disabled");
                        //$("#CQCODE").attr("isvalid", "").attr("checkexpession", "");
                        //var font = $("#CQCODE").parent().prev().find("font");
                        //if (font.length > 0) {
                        //    font.remove();
                        //}
                        //$("#CQRANGE").attr("disabled", "disabled");
                        //$("#CQRANGE").attr("isvalid", "").attr("checkexpession", "");
                        //var font = $("#CQRANGE").parent().prev().find("font");
                        //if (font.length > 0) {
                        //    font.remove();
                        //}
                        //$("#CQLEVEL").attr("disabled", "disabled");
                        //$("#CQLEVEL").attr("isvalid", "").attr("checkexpession", "");
                        //var font = $("#CQLEVEL").parent().prev().find("font");
                        //if (font.length > 0) {
                        //    font.remove();
                        //}
                        //$("#CQVALIDSTARTTIME").attr("disabled", "disabled");
                        //$("#CQVALIDSTARTTIME").attr("isvalid", "").attr("checkexpession", "");
                        //var font = $("#CQVALIDSTARTTIME").parent().prev().find("font");
                        //if (font.length > 0) {
                        //    font.remove();
                        //}
                        //$("#CQVALIDENDTIME").attr("disabled", "disabled");
                        //$("#CQVALIDENDTIME").attr("isvalid", "").attr("checkexpession", "");
                        //var font = $("#CQVALIDENDTIME").parent().prev().find("font");
                        //if (!!font) {
                        //    font.remove();
                        //}
                        //$("#File3").find("input").attr("disabled", "disabled");
                    } else {
                        document.getElementById("iszzzj1").checked = true;
                        //$("#CQORG").attr("disabled", false);
                        //$("#CQCODE").attr("disabled", false);
                        //$("#CQCODE").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                        //$("#CQCODE").parent().prev().append('<font face="宋体">*</font>');
                        //$("#CQRANGE").attr("disabled", false);
                        //$("#CQRANGE").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                        //$("#CQRANGE").parent().prev().append('<font face="宋体">*</font>');
                        //$("#CQLEVEL").attr("disabled", false);
                        //$("#CQLEVEL").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                        //$("#CQLEVEL").parent().prev().append('<font face="宋体">*</font>');
                        //$("#CQVALIDSTARTTIME").attr("disabled", false);
                        //$("#CQVALIDSTARTTIME").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                        //$("#CQVALIDSTARTTIME").parent().prev().append('<font face="宋体">*</font>');
                        //$("#CQVALIDENDTIME").attr("disabled", false);
                        //$("#CQVALIDENDTIME").attr("isvalid", "yes").attr("checkexpession", "NotNull");
                        //$("#CQVALIDENDTIME").parent().prev().append('<font face="宋体">*</font>');
                        ////$("#div_xk").show();
                        //$("#File3").find("input").attr("disabled", false);
                    }
                    //未审核通过前数据未同步保存后查看需要重新赋值,以免数据被覆盖
                    if (data.data.ISAUDITOVER != '1') {
                        $("#form1").formDeserialize(data.data);
                    }
                }
            })
        } else {
            keyValue = keyValue.length == 0 ? "@Guid.NewGuid().ToString()" : keyValue;
            LoadUpdateList();

        }
        $('.icheck input').iCheck({
            checkboxClass: 'icheckbox_square-blue',
            radioClass: 'iradio_square-blue',
            increaseArea: '20%'
        });
    }
    //初始化上传控件
    function LoadUpdateList() {
        file_upload.init({
            keyValue: keyValue + "01",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader1',
            fileDir: 'Aptitudeinvestigateinfo'
        });
        file_upload.init({
            keyValue: keyValue + "02",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader2',
            fileDir: 'Aptitudeinvestigateinfo'
        });
        //file_upload.init({
        //    keyValue: keyValue + "03",
        //    extensions: '',
        //    isImage: false,
        //    el: '#uploader3',
        //    fileDir: 'Aptitudeinvestigateinfo'
        //});
        file_upload.init({
            keyValue: keyValue + "04",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader4',
            fileDir: 'Aptitudeinvestigateinfo'
        });
        file_upload.init({
            keyValue: keyValue + "05",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader5',
            fileDir: 'Aptitudeinvestigateinfo'
        });
        file_upload.init({
            keyValue: keyValue + "06",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader6',
            fileDir: 'Aptitudeinvestigateinfo'
        });
        file_upload.init({
            keyValue: keyValue + "07",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader7',
            fileDir: 'Aptitudeinvestigateinfo'
        });
        file_upload.init({
            keyValue: keyValue + "08",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader8',
            fileDir: 'Aptitudeinvestigateinfo'
        });
        file_upload.init({
            keyValue: keyValue + "09",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader9',
            fileDir: 'Aptitudeinvestigateinfo'
        });
        file_upload.init({
            keyValue: keyValue + "10",
            extensions: '',
            isImage: false,
            multiple: true,
            el: '#uploader10',
            fileDir: 'Aptitudeinvestigateinfo'
        });
    }

    function GetZzzjGrid() {
        var queryJson = {
            InfoId: keyValue
        };
        var selectedRowIndex = 0;
        var $gridTable = $('#ZzzjgridTable');
        $gridTable.jqGrid({
            autowidth: true,
            height: "200px",
            url: "../../OutsourcingProject/Aptitudeinvestigateinfo/GetZzzjPageJson",
            postData: { queryJson: JSON.stringify(queryJson) },
            datatype: "json",
            colModel: [
                { label: 'id', name: 'id', hidden: true },
                {
                    label: '操作', name: 'oper', width: 150, align: 'center', formatter: function (cellvalue, options, rowObject) {
                        var html = "";
                        html += "<a href=javascript:f_ShowZzzj('" + rowObject.id +"')  title='查看' ><i class='fa fa-eye'></i></a>";
                        if (rowObject.createuserid == currUserID && EditFlag) {
                            html += "<a href=javascript:f_EditZzzj('" + rowObject.id + "')  title='编辑'><i class='fa fa-pencil-square-o'></i></a>";
                            html += "<a href=javascript:f_DelZzzj('" + rowObject.id + "')   title='删除'><i class='fa fa-trash-o'></i></a>";
                        }
                        return html;
                    }
                },
                { label: '资质证件号', name: 'cqcode', width: 150, align: 'center' },
                { label: '资质范围', name: 'cqrange', width: 200, align: 'center' },
                { label: '资质等级', name: 'cqlevel', width: 150, align: 'center' },
                {
                    label: '有效期', name: 'indete', width: 220, align: 'center', formatter: function (cellvalue, options, rowObject) {
                        return rowObject.starttime + "~~" + rowObject.endtime;
                    }
                },
                { label: '发证机关', name: 'cqorg', width: 150, align: 'center' }
            ],
            viewrecords: true,
            rowNum: 30,
            multiboxonly: false,
            multiselect: false,
            pager: "#ZzzjgridPager",
            sortname: 'createdate',
            sortorder: 'desc',
            rownumbers: true,
            shrinkToFit: false,
            gridview: true,
            onSelectRow: function () {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });

    }
    //保存表单;
    function AcceptClick(isSaveorComit) {
        if (isSaveorComit == "0") {
            if ($("#ENGINEERNAME").attr("data-value") == "" || $("#ENGINEERNAME").attr("data-value") == undefined) {
                dialogMsg('请选择外包工程！', 0);
                return false
            }
        } else {
            if (!$('#form1').Validform()) {
                return false;
            }
            //判断是否上传附件
            if (!($("#uploader1 .queueList .filelist").find("tr").length > 1)) {
                dialogMsg('请先上传营业执照！', 0);
                return false
            }
            if (document.getElementById("isxk1").checked) {
                if (!($("#uploader2 .queueList .filelist").find("tr").length > 1)) {
                    dialogMsg('请先上传安全生产许可证！', 0);
                    return false
                }
            }
            if (!!hdkm) {
                if (!($("#uploader9 .queueList .filelist").find("tr").length > 1)) {
                    dialogMsg('请先上传合同附件！', 0);
                    return false
                }
                if (!($("#uploader10 .queueList .filelist").find("tr").length > 1)) {
                    dialogMsg('请先上传协议签订！', 0);
                    return false
                }
            }
            //if (document.getElementById("iszzzj1").checked) {
            //    if (!($("#uploader3 .queueList .filelist").find("tr").length > 1)) {
            //        dialogMsg('请先上传资质证件！', 0);
            //        return false
            //    }
            //}
        }

        var postData = $("#form1").formSerialize(keyValue);
        postData["ISSAVEORCOMMIT"] = isSaveorComit;//isSaveorComit 0 代表初始 1代表提交 2代表保存
        postData["IsDeptAdd"] = 1;
        if (document.getElementById("isxk1").checked)
            postData["ISXK"] = document.getElementById("isxk1").value;
        else
            postData["ISXK"] = document.getElementById("isxk2").value;
        if (document.getElementById("iszzzj1").checked)
            postData["ISZZZJ"] = document.getElementById("iszzzj1").value;
        else
            postData["ISZZZJ"] = document.getElementById("iszzzj2").value;
        $.SaveForm({
            url: "../../OutsourcingProject/Aptitudeinvestigateinfo/SaveForm?keyValue=" + keyValue,
            param: postData,
            loading: "正在保存数据...",
            success: function () {
                $.currentIframe().$("#gridTable").trigger("reloadGrid");
            }
        })
    }

    //审核通过同步 工程 单位 人员信息
    function AcceptAudit() {
        //if (!$('#form1').Validform()) {
        //    return false;
        //}
        var auditResult = "";
        if (document.getElementById("AUDITRESULT1").checked == true) {
            auditResult = document.getElementById("AUDITRESULT1").value;
        } else {
            auditResult = document.getElementById("AUDITRESULT2").value;
        }
        var postData = {
            AUDITRESULT: auditResult,
            AUDITTIME: $("#AUDITTIME").val(),
            AUDITPEOPLE: $("#AUDITPEOPLE").val(),
            AUDITPEOPLEID: $("#AUDITPEOPLEID").val(),
            AUDITDEPT: $("#AUDITDEPT").val(),
            AUDITOPINION: $("#AUDITOPINION").val(),
            AUDITDEPTID: $("#AUDITDEPTID").val(),
            APTITUDEID: keyValue,
            FlowId: $("#FlowId").val()
        };
        $.SaveForm({
            url: "../../OutsourcingProject/Aptitudeinvestigateaudit/SaveSynchrodata?keyValue=" + $("#auditId").val(),
            param: postData,
            loading: "正在保存数据...",
            success: function () {
                $.currentIframe().$("#gridTable").trigger("reloadGrid");
            }
        })
    }
    //发包部门
    function loadSendDept(orgid) {
        //发包部门
        var json = JSON.stringify(
                  {
                      SelectMode: 0,
                      Mode: 44
                  }
                );
        $("#ENGINEERLETDEPTID").ComboBoxTree({
            url: "../../BaseManage/Department/GetDepartTreeJson",
            param: { json: json },
            id: "DepartmentId",
            text: "FullName",
            description: "==请选择==",
            height: "200px"
        }).bind("change", function () {
            //外包单位
            $("#OUTPROJECTID").ComboBox({
                url: "../../BaseManage/Department/GetOutProjectBySendDeptId",
                param: { orgid: orgid },
                id: "DepartmentId",
                text: "FullName",
                description: "==请选择==",
                height: "200px"
            }).bind("change", function () {
                //$.SetForm({
                //    url: "../../BaseManage/Department/GetFormJson",
                //    param: { keyValue: $(this).attr('data-value') },
                //    success: function (data) {
                //        $("#ENGINEERDIRECTOR").val(data.Manager);
                //        $("#ENGINEERDIRECTORPHONE").val(data.InnerPhone);
                //    }
                //})
                $.SetForm({
                    url: "../../OutsourcingProject/Outsourcingproject/GetEntityByDeptId",
                    param: { DeptId: $(this).attr('data-value') },
                    success: function (data) {
                        $("#form1").formDeserialize(data);
                    }
                })


            })
        });

    }
    //历史记录
    function historyRecord() {
        var dlg = dialogOpen({
            id: 'historyRecord',
            title: '查看历史记录',
            url: '/OutsourcingProject/Aptitudeinvestigateinfo/HistoryRecord?historyzzscid=' + keyValue,
            width: "800px",
            height: "500px",
            btn: ["关闭"],
            callBack: function (iframeId) {
                top.layer.close(dlg);
            }
        });
    }


    function LoadAuditList() {
        var queryJson = {
            aptitudeid: keyValue
        };
        var selectedRowIndex = 0;
        var $gridTable = $('#gridAudit');
        $gridTable.jqGrid({
            autowidth: true,
            height: "200px",
            url: "../../OutsourcingProject/Aptitudeinvestigateaudit/GetPageListJson",
            postData: { queryJson: JSON.stringify(queryJson) },
            datatype: "json",
            colModel: [
                { label: 'id', name: 'id', hidden: true },
                {
                    label: '审核部门', name: 'auditdept', width: 300, align: 'center',
                },
                {
                    label: '审核人', name: 'auditpeople', width: 180, align: 'center',
                },

                {
                    label: '审核结果', name: 'auditresult', width: 120, align: 'center',
                    formatter: function (cellvalue, options, rowObject) {
                        if (cellvalue == "0") {
                            cellvalue = "合格";
                        } else if (cellvalue == "1") {
                            cellvalue = "不合格";
                        }

                        else {
                            cellvalue = "待审核";
                        }
                        return cellvalue;
                    }
                },
            {
                label: '审核意见', name: 'auditopinion', width: 220, align: 'center',
            },
            {
                label: '审核时间', name: 'audittime', width: 220, align: 'center',
            }
            ],
            viewrecords: true,
            rowNum: 30,
            multiboxonly: false,
            multiselect: false,
            pager: "#AuditPager",
            sortname: 'createdate',
            sortorder: 'desc',
            rownumbers: true,
            shrinkToFit: false,
            gridview: true,
            onSelectRow: function () {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });
    }

    function addZzzj() {
        var dlg = dialogOpen({
            id: 'ZzzjForm',
            title: '新增资质证件',
            url: '/OutsourcingProject/Aptitudeinvestigateinfo/AddZzzjForm?mode=Add&InfoId='+keyValue+'&keyValue=',
            width: "600px",
            height: "500px",
            btn: ["确认"],
            callBack: function (iframeId) {
                top.frames[iframeId].AcceptClick();
            }
        })
    }
    function f_ShowZzzj(id) {
        var dlg = dialogOpen({
            id: 'ZzzjForm',
            title: '查看资质证件',
            url: '/OutsourcingProject/Aptitudeinvestigateinfo/AddZzzjForm?mode=View&keyValue='+id,
            width: "600px",
            height: "500px",
            btn: ["关闭"],
            callBack: function (iframeId) {
                top.layer.close(dlg);
            }
        })
    }
    function f_EditZzzj(id) {
        var dlg = dialogOpen({
            id: 'ZzzjForm',
            title: '查看资质证件',
            url: '/OutsourcingProject/Aptitudeinvestigateinfo/AddZzzjForm?mode=Edit&keyValue='+id+'&InfoId='+keyValue,
            width: "600px",
            height: "500px",
            btn: ["确认"],
            callBack: function (iframeId) {
                top.frames[iframeId].AcceptClick();
            }
        })
    }
    function f_DelZzzj(id) {
        if (id) {
            $.RemoveForm({
                url: '../../OutsourcingProject/Aptitudeinvestigateinfo/RemoveZzzjForm',
                param: { keyValue: id },
                success: function (data) {
                    $('#ZzzjgridTable').trigger('reloadGrid');
                }
            })
        } else {
            dialogMsg('请选择需要删除的资质证件！', 0);
        }
    }
    function xzry(str) {
        if ($("#OUTPROJECTID").attr("data-value") == "" || $("#OUTPROJECTID").attr("data-value") == undefined) {
            dialogMsg('请先选择工程！', 0);
            return;
        }
        switch (str) {
            case "Mandator":
                selectUser({ deptId: $("#OUTPROJECTID").attr("data-value"), userIds: '', checkMode: 0, mode: 0, winObject: window.document.body, domId: 'Mandator,,MandatorId' });
                break;
            case "Certigier":
                selectUser({ deptId: $("#OUTPROJECTID").attr("data-value"), userIds: '', checkMode: 0, mode: 0, winObject: window.document.body, domId: 'Certigier,,CertigierId' });
                break;
            default:
        }
    }
    function ChangeMandator(str) {
        switch (str) {
            case "Mandator":
                $("#MandatorId").val("");
                break;
            case "Certigier":
                $("#CertigierId").val("");
                break;
            default:

        }
    }
</script>
<div style=" margin-left:20px; margin-right: 30px; padding-top:50px;">
    <div id="div_outEngineer" class="panel panel-default">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;工程基本信息</strong>
            <span class="tools pull-right">
                <a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <table class="form">
                <tr>
                    <td class="formTitle" style="width:140px;">外包工程名称<font face="宋体">*</font></td>
                    <td class="formValue">
                        <div id="ENGINEERNAME" isvalid="yes" checkexpession="NotNull" class="form-control"></div>
                        <input id="OUTENGINEERID" type="hidden" class="form-control" />
                    </td>
                    <td class="formTitle" style="width:140px;">工程编码</td>
                    <td class="formValue">
                        <input id="ENGINEERCODE" type="text" readonly="readonly" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">所属区域</td>
                    <td class="formValue">
                        <input id="EngAreaName" type="text" readonly="readonly" class="form-control" />
                       @* <div id="ENGINEERAREA" type="select" class="ui-select" readonly="readonly"></div>*@
                    </td>
                    <td class="formTitle">工程类型</td>
                    <td class="formValue">
                        <div id="ENGINEERTYPE" type="select" class="ui-select" readonly="readonly"></div>
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">工程风险等级</td>
                    <td class="formValue">
                        <div id="ENGINEERLEVEL" type="select" class="ui-select" readonly="readonly"></div>
                    </td>
                    <td class="formTitle">工程规模(万元)</td>
                    <td class="formValue">
                        <input id="ENGINEERSCALE" type="text" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">保证金(万元)</td>
                    <td class="formValue">
                        <input id="ENGINEERCASHDEPOSIT" type="text" class="form-control" />
                    </td>
                    <td class="formTitle">责任部门</td>
                    <td class="formValue">
                        <div id="ENGINEERLETDEPTID" type="select" class="ui-select" readonly="readonly"></div>
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">外包单位</td>
                    <td class="formValue">
                        <div id="OUTPROJECTID" type="select" class="ui-select" readonly="readonly"></div>
                    </td>
                    <td class="formTitle ProjectManager">项目经理<font face="宋体">*</font></td>
                    <td class="formValue ProjectManager">
                        <input id="ProjectManager" type="text" class="form-control" isvalid="yes" checkexpession="NotNull"/>
                    </td>
                </tr>
                <tr>
                    <td class="formTitle ProjectManagerTel">项目经理电话<font face="宋体">*</font></td>
                    <td class="formValue ProjectManagerTel">
                        <input id="ProjectManagerTel" type="text" isvalid="yes" checkexpession="MobileOrPhone" class="form-control" />
                    </td>
                    <td class="formTitle">外包单位工程负责人<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="ENGINEERDIRECTOR" type="text" isvalid="yes" checkexpession="NotNull" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">外包单位工程负责人电话<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="ENGINEERDIRECTORPHONE" type="text" isvalid="yes" checkexpession="MobileNotNull" class="form-control" />
                    </td>
                    <td class="formTitle">外包单位现场负责人<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="UnitSuper" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                    </td>

                </tr>
                <tr>
                    <td class="formTitle">外包单位现场负责人电话<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="UnitSuperPhone" type="text" class="form-control" isvalid="yes" checkexpession="MobileNotNull" />
                    </td>
                    <td class="formTitle">外包单位安全负责人<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="SafetyModerator" type="text" class="form-control" isvalid="yes" checkexpession="NotNull"/>
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">外包单位安全负责人电话<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="SafetyModeratorTel" type="text" isvalid="yes" checkexpession="MobileOrPhone" class="form-control" />
                    </td>
                    <td class="formTitle" >安全管理人数<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="SAFEMANAGERPEOPLE" type="text" isvalid="yes" checkexpession="PositiveNum" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle" id="tr_ENGINEERWORKPEOPLE">工程作业人数<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="ENGINEERWORKPEOPLE" type="text" isvalid="yes" checkexpession="PositiveNum" class="form-control" />
                    </td>
                    <td class="formTitle" id="tr_ENGINEERTECHPERSON">工程技术人数<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="ENGINEERTECHPERSON" type="text" isvalid="yes" checkexpession="PositiveNum" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">工程内容</td>
                    <td class="formValue" colspan='3'>
                        <textarea id="ENGINEERCONTENT" class="form-control"></textarea>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="div_project" class="panel panel-default">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;完善单位基本信息</strong>
            <span class="tools pull-right">
                <a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <table class="form">
                <tr>
                    <td class="formTitle">外包单位名称<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="OUTSOURCINGNAME" type="text" readonly="readonly" class="form-control" isvalid="yes" checkexpession="NotNull" />
                 
                    </td>
                    @*<td class="formTitle">统一社会信用代码<font face="宋体">*</font></td>
                        <td class="formValue">
                            <input id="CREDITCODE" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                        </td>*@
                </tr>
                <tr>
                    <td class="formTitle">法人代表<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="LEGALREP" type="text" class="form-control" />
                    </td>
                    <td class="formTitle">法人代表电话</td>
                    <td class="formValue">
                        <input id="LEGALREPPHONE" type="text" class="form-control" isvalid="yes" checkexpession="MobileOrNull" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">法人代表传真</td>
                    <td class="formValue">
                        <input id="LEGALREPFAX" type="text" class="form-control" />
                    </td>
                    <td class="formTitle">联系人<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="LINKMAN" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">联系人电话<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="LINKMANPHONE" type="text" class="form-control" isvalid="yes" checkexpession="MobileNotNull" />
                    </td>
                    <td class="formTitle">联系人传真</td>
                    <td class="formValue">
                        <input id="LINKMANFAX" type="text" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">电子邮箱</td>
                    <td class="formValue">
                        <input id="EMAIL" type="text" class="form-control" isvalid="yes" checkexpession="isEmailOrNull" />
                    </td>
                    <td class="formTitle">企业地址</td>
                    <td class="formValue">
                        <input id="ADDRESS" type="text" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">外包单位概况</td>
                    <td class="formValue" colspan='3'>
                        <textarea id="GENERALSITUATION" maxlength="2000" class="form-control"></textarea>
                    </td>
                </tr>

            </table>
        </div>
    </div>
    <div id="div_zzhi" class="panel panel-default">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;单位资质信息</strong>
            <span class="tools pull-right">
                <a href="javascript:historyRecord(this)" class="btn btn-primary btn-xs">历史记录</a>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>营业执照</h5>
                    <div class="ibox-tools">

                    </div>
                </div>
                <div class="ibox-content">
                    <table class="form">
                        <tr>
                            <td class="formTitle">发证机关</td>
                            <td class="formValue">
                                <input id="BUSCERTIFICATE" type="text" class="form-control" />
                            </td>
                            <td class="formTitle">统一社会信用代码<font face="宋体">*</font></td>
                            <td class="formValue">
                                <input id="BUSCODE" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                            </td>
                        </tr>
                        <tr>
                            <td class="formTitle">有效时间起<font face="宋体">*</font></td>
                            <td class="formValue">
                                <input id="BUSVALIDSTARTTIME" type="text" class="form-control input-datepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd', maxDate: '#F{$dp.$D(\'BUSVALIDENDTIME\')}' })" isvalid="yes" checkexpession="NotNull" />
                            </td>
                            <td class="formTitle">有效时间止<font face="宋体">*</font></td>
                            <td class="formValue">
                                <input id="BUSVALIDENDTIME" type="text" class="form-control input-datepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd', minDate: '#F{$dp.$D(\'BUSVALIDSTARTTIME\')}' })" isvalid="yes" checkexpession="NotNull" />
                            </td>
                        </tr>
                    </table>
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>营业执照</h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">

                            <div id="uploader1" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:80px; margin-bottom:10px;">
                                <div class="queueList">
                                    <div id="File1" class="placeholder">
                                        <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                    </div>
                                </div>
                                <div class="statusBar" style="display:none;">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div>
                                    <div class="info"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="ibox" id="aqxk">
                <div class="ibox-title">
                    <h5>安全生产许可证</h5>
                    <div class="ibox-tools">

                    </div>
                </div>
                <div class="ibox-content" id="aqxk_content">
                    <table class="form">
                        <tr>
                            <td class="formTitle" style="width:200px;">本工程是否需要安全生产许可证</td>
                            <td class="formValue icheck">
                                <div class="radio-inline">
                                    <label>
                                        <input type="radio" name="isxk" id="isxk1" value="0" checked="checked" />是
                                    </label>
                                </div>
                                <div class="radio-inline">
                                    <label>
                                        <input type="radio" name="isxk" id="isxk2" value="1" />否
                                    </label>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="formTitle">发证机关</td>
                            <td class="formValue">
                                <input id="SPLCERTIFICATE" type="text" class="form-control" />
                            </td>
                            <td class="formTitle">许可证号<font face="宋体">*</font></td>
                            <td class="formValue">
                                <input id="SPLCODE" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                            </td>
                        </tr>
                        <tr>
                            <td class="formTitle">有效时间起<font face="宋体">*</font></td>
                            <td class="formValue">
                                <input id="SPLVALIDSTARTTIME" type="text" checkexpession="NotNull" isvalid="yes" class="form-control input-datepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd', maxDate: '#F{$dp.$D(\'SPLVALIDENDTIME\')}' })" />
                            </td>
                            <td class="formTitle">有效时间止<font face="宋体">*</font></td>
                            <td class="formValue">
                                <input id="SPLVALIDENDTIME" type="text" checkexpession="NotNull" isvalid="yes" class="form-control input-datepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd', minDate: '#F{$dp.$D(\'SPLVALIDSTARTTIME\')}' })" />
                            </td>
                        </tr>

                    </table>
                    <div id="div_xk" class="ibox">
                        <div class="ibox-title">
                            <h5>安全生产许可证</h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">

                            <div id="uploader2" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:80px; margin-bottom:10px;">
                                <div class="queueList">
                                    <div id="File2" class="placeholder">
                                        <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                    </div>
                                </div>
                                <div class="statusBar" style="display:none;">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div>
                                    <div class="info"></div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
            <div class="ibox">
                <div class="ibox-title">
                    <h5>资质证件</h5>
                    <div class="ibox-tools">
                        <span class="tools pull-right">
                            <a href="javascript:addZzzj(this)" id="ZzzjAdd" class="btn btn-primary btn-xs">新增</a>
                        </span>
                    </div>
                </div>
                <div class="ibox-content">
                    <table class="form">
                        <tr>
                            <td class="formTitle" style="width:200px;">本工程是否需要资质证件</td>
                            <td class="formValue icheck">
                                <div class="radio-inline">
                                    <label>
                                        <input type="radio" name="iszzzj" id="iszzzj1" value="0" checked="checked" />是
                                    </label>
                                </div>
                                <div class="radio-inline">
                                    <label>
                                        <input type="radio" name="iszzzj" id="iszzzj2"  value="1" />否
                                    </label>
                                </div>
                            </td>
                        </tr>
                    </table>
                    <div class="gridPanel">
                        <table id="ZzzjgridTable"></table>
                        <div id="ZzzjgridPager"></div>
                    </div>   
                </div>
            </div>
            <div class="ibox">
                <div class="ibox-title">
                    <h5>其它资质</h5>
                    <div class="ibox-tools">

                    </div>
                </div>
                <div class="ibox-content">
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>近三年施工简历附件</h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">

                            <div id="uploader4" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:80px; margin-bottom:10px;">
                                <div class="queueList">
                                    <div id="File4" class="placeholder">
                                        <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                    </div>
                                </div>
                                <div class="statusBar" style="display:none;">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div>
                                    <div class="info"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>授权委托书</h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">
                            <table class="form">
                                <tr>
                                    <td class="formTitle">授权人</td>
                                    <td class="formValue">
                                        <input id="Mandator" style="width:80%;float:left;" type="text" maxlength="50" onchange="ChangeMandator('Mandator')" class="form-control" />
                                        <input id="MandatorId" type="hidden" class="form-control" />
                                        <input type="button" class="btn btn-primary" onclick="xzry('Mandator')" value="选 择" />
                                    </td>
                                    <td class="formTitle">代理人(委托人)</td>
                                    <td class="formValue">
                                        <input id="Certigier" style="width:80%;float:left;" type="text" maxlength="50" onchange="ChangeMandator('Certigier')" class="form-control" />
                                        <input id="CertigierId" type="hidden" class="form-control" />
                                        <input type="button" class="btn btn-primary" onclick="xzry('Certigier')" value="选 择" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="formTitle">有效时间起</td>
                                    <td class="formValue">
                                        <input id="ImpowerStartTime" type="text"  class="form-control input-datepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd', maxDate: '#F{$dp.$D(\'ImpowerEndTime\')}' })" />
                                    </td>
                                    <td class="formTitle">有效时间止</td>
                                    <td class="formValue">
                                        <input id="ImpowerEndTime" type="text"  class="form-control input-datepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd', minDate: '#F{$dp.$D(\'ImpowerStartTime\')}' })" />
                                    </td>
                                </tr>

                            </table>
                            <div id="uploader5" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:80px; margin-bottom:10px;">
                                <div class="queueList">
                                    <div id="File5" class="placeholder">
                                        <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                    </div>
                                </div>
                                <div class="statusBar" style="display:none;">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div>
                                    <div class="info"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>承诺书 </h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">

                            <div id="uploader6" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:80px; margin-bottom:10px;">
                                <div class="queueList">
                                    <div id="File6" class="placeholder">
                                        <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                    </div>
                                </div>
                                <div class="statusBar" style="display:none;">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div>
                                    <div class="info"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="ibox" id="div9">
                        <div class="ibox-title">
                            <h5>合同信息</h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">
                            <table class="form">
                                <tr>
                                    <td class="formTitle" style="width:100px;">甲方签订单位/人<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="COMPACTFIRSTPARTY" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                    <td class="formTitle" style="width:100px;">乙方签订单位/人<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="COMPACTSECONDPARTY" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="formTitle">合同生效时间<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="COMPACTTAKEEFFECTDATE" type="text" class="form-control" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd' })" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                    <td class="formTitle">合同终止时间<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="COMPACTEFFECTIVEDATE" type="text" class="form-control" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd' })" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="formTitle">合同编号<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="COMPACTNO" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                    <td class="formTitle">合同金额</td>
                                    <td class="formValue">
                                        <input id="COMPACTMONEY" type="text" class="form-control" isvalid="yes" checkexpession="PositiveDoubleOrNull" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="formTitle">备注</td>
                                    <td class="formValue" colspan="3">
                                        <textarea id="COMPACTREMARK" class="form-control" rows="4"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="formTitle">合同附件<font face="宋体">*</font></td>
                                    <td class="formValue" colspan="3">
                                        <div id="uploader9" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:200px; margin-bottom:10px;">
                                            <div class="queueList">
                                                <div id="uploaderFile9" class="placeholder">
                                                    <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                                </div>
                                            </div>
                                            <div class="statusBar" style="display:none;">
                                                <div class="progress">
                                                    <span class="text">0%</span>
                                                    <span class="percentage"></span>
                                                </div>
                                                <div class="info"></div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="ibox" id="div10">
                        <div class="ibox-title">
                            <h5>安全生产管理协议签订信息</h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">
                            <table class="form">
                                <tr>
                                    <td class="formTitle" style="width:120px;">甲方签订单位/人员<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="PROTOCOLFIRSTPARTY" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                    <td class="formTitle" style="width:120px;">乙方签订单位/人员<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="PROTOCOLSECONDPARTY" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="formTitle">签订地点<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="SIGNPLACE" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                    <td class="formTitle">签订时间<font face="宋体">*</font></td>
                                    <td class="formValue">
                                        <input id="SIGNDATE" type="text" class="form-control" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd' })" isvalid="yes" checkexpession="NotNull" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="formTitle">协议签订<br />凭证上传<font face="宋体">*</font></td>
                                    <td class="formValue" colspan="3">
                                        <div id="uploader10" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:200px; margin-bottom:10px;">
                                            <div class="queueList">
                                                <div id="uploaderFile10" class="placeholder">
                                                    <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                                </div>
                                            </div>
                                            <div class="statusBar" style="display:none;">
                                                <div class="progress">
                                                    <span class="text">0%</span>
                                                    <span class="percentage"></span>
                                                </div>
                                                <div class="info"></div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="ibox">
                        <div class="ibox-title">
                            <h5>其他审核文件</h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">

                            <div id="uploader7" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:80px; margin-bottom:10px;">
                                <div class="queueList">
                                    <div id="File7" class="placeholder">
                                        <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                    </div>
                                </div>
                                <div class="statusBar" style="display:none;">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div>
                                    <div class="info"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="ibox" id="div8">
                        <div class="ibox-title">
                            <h5>工伤保险缴纳证明</h5>
                            <div class="ibox-tools">

                            </div>
                        </div>
                        <div class="ibox-content">

                            <div id="uploader8" class="uploader" style="border:1px solid #ccc; margin-top:10px; min-height:80px; margin-bottom:10px;">
                                <div class="queueList">
                                    <div id="File8" class="placeholder">
                                        <div class="filePicker" style="margin-left:25px; margin-top:10px;"></div>
                                    </div>
                                </div>
                                <div class="statusBar" style="display:none;">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div>
                                    <div class="info"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="AuditEngineer" class="panel panel-default">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;审核信息</strong>
            <span class="tools pull-right">
                <a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <div id="AuditDiv" class="gridPanel">
                <table id="gridAudit"></table>
                <div id="AuditPager"></div>
            </div>
            <table id="tabAudit" class="form">
                <tr>
                    <td class="formTitle">审核结果</td>
                    <td class="formValue">
                        <div class="radio-inline">
                            <label>
                                <input type="radio" name="AUDITRESULT" id="AUDITRESULT1" value="0" checked="checked" />合格
                            </label>
                        </div>
                        <div class="radio-inline">
                            <label>
                                <input type="radio" name="AUDITRESULT" id="AUDITRESULT2" value="1" />不合格
                            </label>
                        </div>
                    </td>
                    <td class="formTitle">审核日期</td>
                    <td class="formValue">
                        <input id="AUDITTIME" type="text" class="form-control" readonly="readonly" />
                        <input id="FlowId" type="hidden" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">审核人</td>
                    <td class="formValue">
                        <input id="AUDITPEOPLE" type="text" readonly="readonly" value="@ERCHTMS.Code.OperatorProvider.Provider.Current().UserName" class="form-control" />
                        <input id="AUDITPEOPLEID" type="hidden" value="@ERCHTMS.Code.OperatorProvider.Provider.Current().UserId" class="form-control" />
                    </td>
                    <td class="formTitle">审核部门</td>
                    <td class="formValue">

                        <input id="AUDITDEPT" type="text" readonly="readonly" value="" class="form-control" />
                        <input id="AUDITDEPTID" type="hidden" value="@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptId" class="form-control" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">审核意见</td>
                    <td class="formValue" colspan="3">
                        <textarea id="AUDITOPINION" maxlength="1000" class="form-control"></textarea>
                        <input id="auditId" type="hidden" class="form-control" />
                    </td>

                </tr>

            </table>
        </div>
    </div>
    <div id="btngroup" class="form-button" style=" top:40px;  text-align: left; padding-left: 20px; position: fixed; bottom: auto; z-index: 1000;">
        <a onclick="AcceptClick('0')" class="btn btn-primary"><i class="fa fa-mail-forward"></i>&nbsp;确&nbsp;&nbsp;认</a>
        &nbsp;&nbsp;
        <a onclick="AcceptClick('1')" class="btn btn-primary"><i class="fa fa-mail-forward"></i>&nbsp;提&nbsp;&nbsp;交</a>
        &nbsp;&nbsp;
    </div>
    @*<div class="layui-layer-btn" style="float:right" id="btngroup">
            <a class="layui-layer-btn2" onclick="AcceptClick('1')">提 交</a>
            <a class="layui-layer-btn0" onclick="AcceptClick('0')">保 存</a>
        </div>*@
</div>
