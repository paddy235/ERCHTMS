@{;
    ViewBag.Title = "表单页面";
    Layout = "~/Views/Shared/_Form.cshtml";
}
<script src="~/Content/scripts/business/Common.js" type="text/javascript"></script>

<!--webUploader文件上传组件-->
<link href="~/content/scripts/plugins/webuploader/webuploader.css" rel="stylesheet" />
<link href="~/content/scripts/plugins/webuploader/webuploader-demo.css" rel="stylesheet" />
<script type="text/javascript" src="~/content/scripts/plugins/webuploader/webuploader.min.js"></script>
<script type="text/javascript" src="~/content/scripts/business/fileupload.js"></script>

<style>
    .form .formTitle {
        width: 110px;
    }

    .form .formValue select {
        padding: 0px;
    }
</style>
<script>
    var keyValue = request('keyValue');
    var mode = request('mode');

    //获取当前登录人信息
    var deptname = "@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptName";
    var deptid = "@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptId";
    var deptcode = "@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptCode";
    var userid = "@ERCHTMS.Code.OperatorProvider.Provider.Current().UserId";
    var username = "@ERCHTMS.Code.OperatorProvider.Provider.Current().UserName";
    //当前登录人所拥有的角色
    var rolenames = "@ERCHTMS.Code.OperatorProvider.Provider.Current().RoleName";
    var editFile = true;//表示是否可以上传,删除附件
    var riskFlag = false;
    var isHDGZ = '@(new ERCHTMS.Busines.SystemManage.DataItemDetailBLL().GetItemValue("贵州毕节版本"))';
    var isJdz = '@(new ERCHTMS.Busines.SystemManage.DataItemDetailBLL().GetItemValue("景德镇版本"))';
    var rownum = 0;//行数
    var selectRowCurIndex;                       //当前选中行下标
    var mbPlaceFileId = "";//盲板图id
    var isInit = false;

    $(function () {
        initControl();
        //加载安全措施(带入配置中的数据)
        LoadMeasureList();
        //加载作业安全分析
        //GetRiskGrid();
        //盲板抽堵作业
        ChangeMBCDZY();

    });
    //初始化控件
    function initControl() {
        //resize重设布局;
        $(window).resize(function (e) {
            window.setTimeout(function () {

            }, 200);
            e.stopPropagation();
        });
        if (mode == "view") {
            $("#btn_Save,#btn_Submit").attr("style", "display:none");
            $("#form1 input,textarea,select, .ui-select, .ui-select-text , .ui-select-option-content").each(function (ele, index) {
                $(this).attr("disabled", "disabled");
            });
            editFile = false;
        }

        if (mode == "add" || mode == "edit") {
            riskFlag = true;
            $("#select,#choose1").removeAttr("disabled");
        }

        if (!isHDGZ) {
            $("#tr_worklicensor").hide();
            $("#WorkLicensorName").removeAttr("isvalid");
        }


        //通用作业类型
        $("#WorkType").ComboBox({
            param: { EnCode: "CommonType" },
            url: "../../SystemManage/DataItemDetail/GetDataItemListJson",
            description: "======请选择======",
            id: "ItemValue",
            text: "ItemName",
            height: "230px"
        }).bind("change", function () {
            $("#WorkType-option").css("top", "109px");
            //-2只为查询不到安全措施的数据
            if ($("#Result").val() == "0") {
                var queryJson = {
                    code: !!($("#WorkType").attr("data-value")) ? $("#WorkType").attr("data-value") : "-2"
                }
                $('#gridMeasure').jqGrid('setGridParam', {
                    postData: { queryJson: JSON.stringify(queryJson) }, page: 1
                }).trigger('reloadGrid');
            }

            if (!!isJdz) {
                var text = $("#WorkType").attr("data-text");
                if (text == "有限空间作业")
                {
                    $("#tr_worklicensor").show();
                    $("#WorkLicensorName").attr("isvalid", "yes");
                    $("#trElectricity").hide();
                }
                else if (text == "断路作业" || text == "破土作业") {
                    $("#tr_worklicensor").hide();
                    $("#WorkLicensorName").removeAttr("isvalid");
                    $("#trElectricity").show();
                }
                else {
                    $("#tr_worklicensor").hide();
                    $("#WorkLicensorName").removeAttr("isvalid");
                    $("#trElectricity").hide();
                }
                //盲板抽堵作业
                ChangeMBCDZY();
                $("#RiskType").attr("data-text", "");
                $("#RiskType").attr("data-value", "");
                $("#RiskType div:eq(0)").text("=请选择=");
            }
            });


        $.ajax({
            url: '../../HighRiskWork/HighRiskCommonApply/GetShowPattern',
            data: { showtype: "1" },//安全措施
            dataType: "JSON",
            async: false,
            success: function (result) {
                $("#Result").val(result);
                //0：带入配置中的数据 1:手动输入
                if (result == "1") {
                    //隐藏
                    $("#safetyMeasure").attr("style", "display:none");
                }
                else {
                    //显示并加载安全措施(带入配置中的数据)
                    $("#safetyMeasure").attr("style", "display:block");

                }
            }
        });

        if (rolenames.indexOf("承包商") >= 0 || rolenames.indexOf("分包商") >= 0) {
            $("input[name='WorkDeptType']:eq(1)").prop("checked", "checked");
            $("input[name='WorkDeptType']").attr("disabled", "disabled");
            $("#td_title_projectname").show();
            $("#td_value_projectname").show();

        }
        else {
            $("input[name='WorkDeptType']:eq(0)").prop("checked", "checked");
            $("#td_title_projectname").hide();
            $("#td_value_projectname").hide();
            $("#EngineeringName").removeAttr("checkexpession").removeAttr("isvalid");
        }


        $("#ApplyDeptName").val(deptname);
        $("#ApplyDeptId").val(deptid);
        $("#ApplyDeptCode").val(deptcode);
        $("#ApplyUserId").val(userid);
        $("#ApplyUserName").val(username);
        $("#CreateDate").val("@DateTime.Now.ToString("yyyy-MM-dd HH:mm")");

        //选择作业单位类别时，控制工程名称显示
        $("input[name='WorkDeptType']").click(function () {
            //0:单位内部,1:外包单位
            if ($(this).val() == "0") {
                $("#td_title_projectname").hide();
                $("#td_value_projectname").hide();
                $("#EngineeringName").removeAttr("checkexpession").removeAttr("isvalid");

            } else {
                $("#td_title_projectname").show();
                $("#td_value_projectname").show();
                $("#EngineeringName").attr("checkexpession", "NotNull").attr("isvalid", "yes");

            }
            //清空文本框(作业单位,工程,作业人员,作业区域)
            $("#WorkDeptName,#WorkDeptId,#WorkDeptCode,#WorkAreaName,#WorkAreaCode,#EngineeringId,#EngineeringName").val("");
            $("#SpecialtyType").html("");
            $("#SpecialtyType").append('<option value="">请选择</option>');
            clearUser();
        });

        //选择非工作时段审批,控制审批部门显示
        $("input[name='NonWorkingApprove']").click(function () {
            //0:否,1:是
            if ($(this).val() == "0") {
                $("#td_title_approvedept").hide();
                $("#td_value_approvedept").hide();
                $("#ApproveDept").removeAttr("checkexpession").removeAttr("isvalid");

            } else {
                $("#td_title_approvedept").show();
                $("#td_value_approvedept").show();
                $("#ApproveDept").attr("checkexpession", "NotNull").attr("isvalid", "yes");

            }
            //清空文本框(审批部门)
            $("#ApproveDept,#ApproveDeptId,#ApproveDeptCode").val("");
        });

        //区域的处理
        $("#WorkAreaName").attr("onclick", "selectArea(window.document.body, 'WorkAreaName,WorkAreaCode');").attr("placeholder", "请选择作业区域");

        //保存
        $("#btn_Save").click(function () {
            AcceptClick("0");
        });

        //提交
        $("#btn_Submit").click(function () {
            AcceptClick("1");
        });
        BindRiskType("");
        //获取表单
        if (!!keyValue) {
            $.SetForm({
                url: "../../HighRiskWork/HighRiskCommonApply/GetFormJson",
                param: { keyValue: keyValue },
                success: function (data) {
                    if (data != null) {
                        BindRiskType(data.WorkType);
                    }
                    $("#form1").formDeserialize(data);
                    if (data.WorkDeptType == "0") {//单位内部
                        $("#td_title_projectname").hide();
                        $("#td_value_projectname").hide();
                        $("input[name='WorkDeptType']:eq(0)").prop("checked", "checked");
                        $("#EngineeringName").removeAttr("checkexpession").removeAttr("isvalid");
                        GetSpecialty(data.WorkDeptId, data.SpecialtyType);
                    }
                    if (data.WorkDeptType == "1") {//外包单位
                        $("input[name='WorkDeptType']:eq(1)").prop("checked", "checked");
                        $("#td_title_projectname").show();
                        $("#td_value_projectname").show();
                        $("#EngineeringName").attr("checkexpession", "NotNull").attr("isvalid", "yes");
                        GetSpecialty(data.EngineeringId, data.SpecialtyType);
                    }

                    if (data.NonWorkingApprove == "0") {
                        $("input[name='NonWorkingApprove']:eq(0)").prop("checked", "checked");
                        $("#td_title_approvedept").hide();
                        $("#td_value_approvedept").hide();
                        $("#ApproveDept").removeAttr("checkexpession").removeAttr("isvalid");
                    }
                    if (data.NonWorkingApprove == "1") {
                        $("input[name='NonWorkingApprove']:eq(1)").prop("checked", "checked");
                        $("#td_title_approvedept").show();
                        $("#td_value_approvedept").show();
                        $("#ApproveDept").attr("checkexpession", "NotNull").attr("isvalid", "yes");
                    }
                    $("input[name='IsMessage']:eq(" + data.IsMessage + ")").prop("checked", "checked");
                    if (!!isJdz) {
                        var text = $("#WorkType").attr("data-text");
                        if (text == "有限空间作业") {
                            $("#tr_worklicensor").show();
                            $("#WorkLicensorName").attr("isvalid", "yes");
                            $("#trElectricity").hide();
                        }
                        else if (text == "断路作业" || text == "破土作业") {
                            $("#tr_worklicensor").hide();
                            $("#WorkLicensorName").removeAttr("isvalid");
                            $("#trElectricity").show();
                        }
                        else {
                            $("#tr_worklicensor").hide();
                            $("#WorkLicensorName").removeAttr("isvalid");
                            $("#trElectricity").hide();
                        }
                        var workType = $("#WorkType").attr("data-value");
                        if (workType == "12") {
                            if (data.DangerAnalyse == "1") {
                                $("input[name='DangerAnalyse']:eq(0)").prop("checked", "checked");
                            } else {
                                $("input[name='DangerAnalyse']:eq(1)").prop("checked", "checked");
                            }
                            if (data.SafetyAnalyse == "1") {
                                $("input[name='SafetyAnalyse']:eq(0)").prop("checked", "checked");
                            } else {
                                $("input[name='SafetyAnalyse']:eq(1)").prop("checked", "checked");
                            }
                        }
                    }
                }

            })
        }

        keyValue = keyValue.length == 0 ? "@Guid.NewGuid().ToString()" : keyValue;
        if ($("#WorkType").attr("data-value") == "11" && isInit == false) {
            //盲板图位置
            LoadMBT();
            //file_upload.init({
            //    keyValue: keyValue + "_01", extensions: 'jpg,gif,bmp,png,jpeg', isImage: false, el: '#uploader2'
            //});
            //file_upload.bindFiles(editFile, false, keyValue + "_01", 'uploader2', editFile);
            isInit = true;
        }
        file_upload.init({
            keyValue: keyValue, extensions: 'jpg,png,jpeg,doc,docx,xls,xlsx,pdf,rar,zip', isImage: false, el: '#uploader1'
        });
        file_upload.bindFiles(editFile, false, keyValue, 'uploader1', editFile);
    }

    function BindRiskType(workType) {
        var enCode = "";
        //景德镇 作业类型为“高处作业”,显示作业级别，风险等级隐藏
        if (!!isJdz && workType == "12") {
            enCode = "CommonWorkType";
        } else {
            enCode = "CommonRiskType";
        }

        //风险等级
        $("#RiskType").ComboBox({
            param: { EnCode: enCode },
            url: "../../SystemManage/DataItemDetail/GetDataItemListJson",
            description: "=请选择=",
            id: "ItemValue",
            text: "ItemName",
            height: "230px"
        });
    }

    //保存表单;
    function AcceptClick(type) {
        if (!$('#form1').Validform()) {
            return false;
        }
        var RiskRecord = $("#RiskRecord").val();
        $("#RiskRecord").val("");
        var postData = $("#form1").formSerialize(keyValue);
        //存储作业单位类别
        var unittype = $("input[name='WorkDeptType']:checked").val();
        postData["WorkDeptType"] = unittype;
        var ismessage = $("input[name='IsMessage']:checked").val();
        postData["IsMessage"] = ismessage;
        var NonWorkingApprove = $("input[name='NonWorkingApprove']:checked").val();
        postData["NonWorkingApprove"] = NonWorkingApprove;
        var $gridTable1 = $('#gridTable1');
        var workType = $("#WorkType").attr("data-value");
        if (!!isJdz) {
            //景德镇版本
            if (workType == "11") {
                //选择盲板抽堵作业
                var rows = $gridTable1.jqGrid('getRowData');
                if (rows.length == 0) {
                    dialogMsg('请添加盲板信息！', 0);
                    return false;
                } else {
                    for (var i = 0; i < rows.length; i++) {
                        delete rows[i].oper;
                        //rows[i].HighRiskCommonApplyId = keyValue;
                    }
                    postData["MBXXRecord"] = JSON.stringify(rows);
                }
            }
            else {
                if (workType == "12") {
                    //选择“高处作业”
                    var dangeranalyse = $("input[name='DangerAnalyse']:checked").val();
                    if (dangeranalyse == "" || dangeranalyse == undefined) {
                        dialogAlert("未勾选工作危险分析(JHA),无法进行提交!!!", function () {
                            return false;
                        });
                        return false;
                    } else {
                        postData["DangerAnalyse"] = dangeranalyse;
                    }
                    var safetyanalyse = $("input[name='SafetyAnalyse']:checked").val();
                    if (safetyanalyse == "" || safetyanalyse == undefined) {
                        dialogAlert("未勾选作业安全分析(JSA),无法进行提交!!!", function () {
                            return false;
                        });
                        return false;
                    } else {
                        postData["SafetyAnalyse"] = safetyanalyse;
                    }
                }
                postData["PipeLine"] = "";
                postData["Media"] = "";
                postData["Temperature"] = "";
                postData["Pressure"] = "";
                postData["ZMBDutyUserName"] = "";
                postData["ZMBDutyUserId"] = "";
                postData["CMBDutyUserName"] = "";
                postData["CMBDutyUserId"] = "";
                postData["MBPlaceFileId"] = "";
                var rows = $gridTable1.jqGrid('getRowData');
                if (rows.length > 0) {
                    $gridTable1.jqGrid("clearGridData");
                }
            }
        }
        //var $gridTable = $('#gridAnalyse');
        //var risk = $gridTable.jqGrid('getRowData');
        //var arr = [];
        //var flag = false;
        //for (var i = 0; i < risk.length; i++) {
        //    var dom = risk[i];
        //    if (($.trim($gridTable.find("textarea[name='atrisk']").eq(i).val()).length == 0 || $.trim($gridTable.find("textarea[name='controls']").eq(i).val()).length == 0 ||$.trim($gridTable.find("textarea[name='worktask']").eq(i).val()).length == 0 ||$.trim($gridTable.find("textarea[name='workprocess']").eq(i).val()).length == 0) && !flag) {
        //        flag = true;
        //    } else {
        //        if($.trim($gridTable.find("textarea[name='worktask']").eq(i).val()).length <=500) {
        //            arr.push({
        //                WorkTask:$gridTable.find("textarea[name='worktask']").eq(i).val(),
        //                WorkProcess:$gridTable.find("textarea[name='workprocess']").eq(i).val(),
        //                AtRisk: $gridTable.find("textarea[name='atrisk']").eq(i).val(),
        //                Controls: $gridTable.find("textarea[name='controls']").eq(i).val(),
        //                WorkId: keyValue,
        //                Id: newGuid(),
        //                CreateDate: formatDate(new Date(), "yyyy-MM-dd hh:mm:ss")
        //            });
        //        }
        //        else
        //        {
        //            dialogMsg("工作任务字符过大,不可超过500个字符！", 2);
        //            return false;
        //        }
        //    }
        //}
        //if (flag) {
        //    dialogMsg("工作任务、工序、风险描述和控制措施都不能为空！", 2);
        //    return false;
        //}
        //json = JSON.stringify(arr);
        //postData["RiskRecord"] = json;

        postData["RiskRecord"] = RiskRecord;
        $.SaveForm({
            url: "../../HighRiskWork/HighRiskCommonApply/SaveForm?keyValue=" + keyValue + "&type=" + type,
            param: postData,
            loading: "正在保存数据...",
            success: function () {
                $.currentIframe().$("#gridTable").trigger("reloadGrid");
            }
        })
    }

    //根据作业单位排除作业人员
    function chooseUser(type) {
        if(type==4){
            selectUser({ deptId: '', checkMode: 1, mode: 0, winObject: window.document.body, domId: 'CopyUserNames,,CopyUserIds,', userIds: "CopyUserIds" });
        }
        else if (type == 5) {
            selectUser({ deptId: '', checkMode: 1, mode: 0, winObject: window.document.body, domId: 'WorkLicensorName,WorkLicensorAccount,WorkLicensorId,', userIds: "WorkLicensorId", threeperson: "工作许可人" });
        }
        else if (type == 2) {
            selectUser({ deptId: '', checkMode: 1, mode: 0, winObject: window.document.body, domId: 'WorkTutelageUserName,,WorkTutelageUserId,' });
        }
        else if (type == 8) {//运行许可人
            selectUser({ deptId: '', checkMode: 0, mode: 0, winObject: window.document.body, domId: 'YXPermitUserName,,YXPermitUserId' });
        }
        else if (type == 9) {//值长/值班负责人
            selectUser({ deptId: '', checkMode: 0, mode: 0, winObject: window.document.body, domId: 'WatchUserName,,WatchUserId' });
        }
        else if (type == 10) {//受影响相关方确认人
            selectUser({ deptId: '', checkMode: 1, mode: 0, winObject: window.document.body, domId: 'EffectConfirmerName,,EffectConfimerId' });
        }
        else {
            if (!!$("#WorkDeptId").val()) {
                switch (type) {
                    //作业负责人
                    case 1:
                        selectUser({ deptId: $('#WorkDeptId').val(), checkMode: 0, mode: 1, winObject: window.document.body, domId: 'WorkDutyUserName,WorkDutyUserAccount,WorkDutyUserId' });
                        break;
                        //作业监护人
                    case 3:
                        selectUser({ deptId: $('#WorkDeptId').val(), checkMode: 1, mode: 1, winObject: window.document.body, domId: 'WorkUserNames,,WorkUserIds', userIds: "WorkUserIds" });
                        break;
                    case 6:
                        //装盲板负责人
                        selectUser({ deptId: $('#WorkDeptId').val(), checkMode: 0, mode: 1, winObject: window.document.body, domId: 'ZMBDutyUserName,,ZMBDutyUserId' });
                        break;
                    case 7:
                        //拆盲板负责人
                        selectUser({ deptId: $('#WorkDeptId').val(), checkMode: 0, mode: 1, winObject: window.document.body, domId: 'CMBDutyUserName,,CMBDutyUserId' });
                        break;
                    default:
                        break;
                }
            }
            else {
                dialogMsg('请先选择作业单位！', 0);
            }
        }
    }


    function showmore(type) {
        switch (type) {
            case 0:
                if (!!$("#WorkUserNames").val()) {
                    var html = $("#WorkUserNames").val();
                    $("#modalBody").html(html);
                    $("#QdModal").modal('show');
                }
                else {
                    dialogMsg('请选择作业人员！', 0);
                }
                break;
            case 1:
                if (!!$("#CopyUserNames").val()) {
                    var html = $("#CopyUserNames").val();
                    $("#modalBody").html(html);
                    $("#QdModal").modal('show');
                }
                else {
                    dialogMsg('请选择抄送人！', 0);
                }
                break;
            case 2:
                if (!!$("#WorkLicensorName").val()) {
                    var html = $("#WorkLicensorName").val();
                    $("#modalBody").html(html);
                    $("#QdModal").modal('show');
                }
                else {
                    dialogMsg('请选择作业许可人！', 0);
                }
                break;
        }
    }

    //选择作业单位
    function selectCompany() {
        var setupcompanytype = $("input[type=radio]:checked").val();
        /**
        1.选择单位内部时，工程名称隐藏,当前角色为“厂级部门”，作业单位为所有单位不包含承包商，否则为作业单位本部门及以下单位。
        2.选择外包单位时，工程名称显示,当前角色为“厂级部门”，作业单位为所有外包单位,否则作业单位为本部门及以下级部门管辖的外包单位。
        3.另工程名称为选择作业单位后单位管辖的工程，选择工程后把作业区域代入文本框。
        **/
        //当前角色为“厂级部门”，作业单位为所有单位，否则为本部门及下及部门单位
        if (setupcompanytype == "0") {
            selectDept('&type=highrisk', 0, 4, '选择作业单位', document.body, 'WorkDeptName,WorkDeptCode,WorkDeptId', "1",function(){
                clearUser();
                var departid = $("#WorkDeptId").val();
                $("#SpecialtyType").html('');
                $("#SpecialtyType").append('<option value="">请选择</option>');
                GetSpecialty(departid, "");
            });

        } else {
            selectDept('', 0, 7, '选择作业单位', document.body, 'WorkDeptName,WorkDeptCode,WorkDeptId', "1", function () {
                clearUser();
                $("#EngineeringId,#EngineeringName").val("");
                $("#SpecialtyType").html('');
                $("#SpecialtyType").append('<option value="">请选择</option>');
            });
        }
    }

    function clearUser(){
        //清空与之关联的作业负责人,作业监护人,作业人员
        $("#WorkUserNames,#WorkUserIds,#WorkDutyUserName,#WorkDutyUserId,#WorkDutyUserAccount,#WorkTutelageUserName,#WorkTutelageUserId").val("");
    }

    //选择工程
    function chooseProject() {
        if (!!$("#WorkDeptName").val()) {
            SelectOutProject(window.document.body, 'EngineeringName,EngineeringId', $("#WorkDeptId").val(), function () {
                var engineeringid = $("#EngineeringId").val()
                $("#SpecialtyType").html('');
                $("#SpecialtyType").append('<option value="">请选择</option>');
                GetSpecialty(engineeringid, "");
                //GetEngineerInfo(engineeringid);
            });

        }
        else {
            dialogMsg('请先选择作业单位！', 0);
        }

    }

    //获取工程详情
    function GetEngineerInfo(id) {
        $.SetForm({
            url: "../../OutsourcingProject/Outsouringengineer/GetFormJson?keyValue=" + id,
            success: function (data) {
                $("#WorkAreaName").val(data.data.ENGINEERAREANAME);
            }
        })
    }

    //获取部门下的专业类别
    function GetSpecialty(departid, stype) {
        var specialtytype = stype;
        if (mode == "edit" || mode == "add") {
            specialtytype = "";
        }
        var workdepttype = $("input[name='WorkDeptType']:checked").val();
        var flag = false;
        $.ajax({
            url: "../../HighRiskWork/Scaffold/GetSpecialtyToJson?deptid=" + departid + "&specialtytype=" + specialtytype + "&workdepttype=" + workdepttype,
            asycn: true,
            type: 'get',
            success: function (data) {
                if (!!data) {
                    var json = JSON.parse(data);
                    for (var i = 0; i < json.length; i++) {
                        if (stype == json[i].itemvalue) {
                            $("#SpecialtyType").append('<option value="' + json[i].itemvalue + '" selected="selected">' + json[i].itemname + '</option>');
                        }
                        else {
                            $("#SpecialtyType").append('<option value="' + json[i].itemvalue + '">' + json[i].itemname + '</option>');
                        }
                    }
                }
            }
        });
    }


    //加载安全措施
    function LoadMeasureList() {
        var queryJson = {
            code: !!($("#WorkType").attr("data-value")) ? $("#WorkType").attr("data-value") : "-2"
        };
        var selectedRowIndex = 0;
        var $gridTable = $('#gridMeasure');
        $gridTable.jqGrid({
            autowidth: true,
            height: 350,
            url: "../../HighRiskWork/HighProjectSet/GetPageListJson",
            postData: { queryJson: JSON.stringify(queryJson) },
            datatype: "json",
            colModel: [
                { label: '主键', name: 'id', width: 10, align: 'left', sortable: true, hidden: true },
                { label: '安全措施', name: 'measurename', index: 'measurename', width: 600, align: 'center', sortable: false },
                {
                    label: '安全措施情况', name: 'measureresultone', index: 'measureresultone', width: 200, align: 'center', sortable: false, formatter: function (cellvalue, options, rowObject) {
                        var html = '<input type="radio" name="WorkDeptType" id="WorkDeptType1" value="0" disabled="disabled"/>' + rowObject.measureresultone + '&nbsp;&nbsp;&nbsp; <input type="radio" name="WorkDeptType" id="WorkDeptType2" value="1" disabled="disabled" />' + rowObject.measureresulttwo + '';
                        return html;
                    }
                }],
            viewrecords: true,
            rowNum: 10,
            rowList: [10, 15, 20],
            pager: "#MeasurePager",
            sortname: 'ordernumber',
            sortorder: 'asc',
            rownumbers: true,
            shrinkToFit: false,
            gridview: true,
            onSelectRow: function () {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });
    }

    ////加载作业安全分析
    //function GetRiskGrid() {
    //    var $gridTable = $('#gridAnalyse');
    //    $gridTable.jqGrid({
    //        url: "../../HighRiskWork/HighRiskCommonApply/GetRiskListJson",
    //        postData: { workId: keyValue },
    //        datatype: "json",
    //        height: "200px",
    //        autowidth: true,
    //        colModel: [
    //            { label: '主键', name: 'Id', hidden: true },
    //            {
    //                label: '操作', name: 'Oper', width: 80, align: 'center',
    //                formatter: function (cellvalue, options, rowObject) {
    //                    var html = "";
    //                    if (riskFlag) {
    //                        html += "&nbsp;&nbsp;<a href=javascript:delRow('" + rowObject.Id + "',this)  title='删除'><i class='fa fa-trash-o'></i></a>";
    //                    }
    //                    return html;
    //                }
    //            },
    //            {
    //                label: '工作任务', name: 'WorkTask', width: 200, align: 'center', sortable: false, formatter: function (cellvalue, options, rowObject) {
    //                    var str = "";
    //                    if (!riskFlag) {
    //                        str = 'disabled = "disable"';
    //                    }
    //                    var html = '<textarea type="text"  name="worktask" ' + str + ' role="textbox" maxlength="500" style="width: 100%;height:50px;" class="form-control"';
    //                    html += '>' + cellvalue + '</textarea>';
    //                    return html;
    //                }
    //            },
    //            {
    //                label: '工序', name: 'WorkProcess', width: 200, align: 'center', sortable: false, formatter: function (cellvalue, options, rowObject) {
    //                    var str = "";
    //                    if (!riskFlag) {
    //                        str = 'disabled = "disable"';
    //                    }
    //                    var html = '<textarea type="text"  name="workprocess" ' + str + ' role="textbox" maxlength="500" style="width: 100%;height:50px;" class="form-control" >';
    //                    if (cellvalue) {
    //                        html += cellvalue + '</textarea>';
    //                    }
    //                    else {
    //                        html += '</textarea>';
    //                    }
    //                    return html;
    //                }
    //            },
    //            {
    //                label: '风险描述', name: 'AtRisk', width: 250, align: 'center', sortable: false, formatter: function (cellvalue, options, rowObject) {
    //                    var str = "";
    //                    if (!riskFlag) {
    //                        str = 'disabled = "disable"';
    //                    }
    //                    var html = '<textarea type="text"  name="atrisk" ' + str + ' role="textbox" maxlength="500"  style="width: 100%;height:50px;" class="form-control" ';
    //                    html += '>' + cellvalue + '</textarea>';
    //                    return html;
    //                }
    //            },
    //            {
    //                label: '风险控制措施', name: 'Controls', width: 200, sortable: false, align: 'center'
    //                , formatter: function (cellvalue, options, rowObject) {
    //                    var str = "";
    //                    if (!riskFlag) {
    //                        str = 'disabled = "disable"';
    //                    }
    //                    var html = '<textarea type="text"  name="controls" ' + str + ' role="textbox" maxlength="500" style="width: 100%;height:50px;" class="form-control" ';
    //                    html += '>' + cellvalue + '</textarea>';
    //                    return html;
    //                }
    //            }
    //        ],
    //        viewrecords: true,
    //        rowNum: 30,
    //        sortname: 'CreateDate',
    //        sortorder: 'desc',
    //        rownumbers: true,
    //        shrinkToFit: false,
    //        gridview: true

    //    });
    //}

    ////删除数据行
    //function delRow(id, obj) {
    //    var jqTable = $("#gridAnalyse");
    //    var idx = dialogConfirm("确认删除吗？", function (isSure) {
    //        if (isSure) {
    //            jqTable.delRowData(jqTable.getGridParam('selrow'));
    //            top.layer.close(idx);
    //        } else {
    //            top.layer.close(idx);
    //        }
    //    });
    //}

    ////添加行
    //function addItems(obj) {
    //    var rowId = $("#gridAnalyse").jqGrid('getRowData').length;
    //    $("#gridAnalyse").addRowData(rowId, { ID: newGuid(),WorkTask:"",WorkProcess:"", AtRisk: "", Controls: "" }, "first");
    //}

    ////从风险库中选择数据
    //function selRisk() {
    //    var worktypevale=$("#WorkType").attr("data-value");
    //    if (!!worktypevale) {
    //        dialogOpen({
    //            id: 'SelectRisk',
    //            title: '选择工作任务',
    //            url: '/HighRiskWork/HighRiskCommonApply/Select?worktypevale=' + worktypevale + '&highrisktype=common',
    //            width: ($(window).width() - 200) + 'px',
    //            height: ($(window).height() - 20) + 'px',
    //            callBack: function (iframeId) {
    //                top.frames[iframeId].AcceptClick();
    //            }
    //        })
    //    }
    //    else {
    //        dialogMsg('请先选择作业类型！', 0);
    //    };
    //}


    function LoadMBList() {
        var selectedRowIndex = 0;
        var $gridTable = $('#gridTable1');
        $gridTable.jqGrid({
            //autowidth: true,
            width:$('.form').width()- 124,
            height:100,
            url:"../../HighRiskWork/HighRiskCommonApply/GetMBListToJson?highRiskId=" + keyValue,
            datatype: "json",
            colModel: [
                { label: '主键', name: 'Id', width: 10, align: 'left', sortable: true, hidden: true },
                {
                    label: '操作', name: 'oper', width: 160, align: 'center', sortable: true, formatter: function (cellvalue, options, rowObject) {
                        var html = "<a href=javascript:mb_edit('" + options.rowId + "') title='编辑'><i class='fa fa-pencil-square-o'></i></a>&nbsp;&nbsp;";
                        html += "<a href=javascript:mb_delete('" + options.rowId + "') title='删除'><i class='fa fa-trash-o'></i></a>";
                        return html;
                    }
                },
                { label: '材质', name: 'Material', index: 'Material', width: 500, align: 'center', sortable: false },
                { label: '规格', name: 'Specification', index: 'Specification', width: 500, align: 'center', sortable: false },
                { label: '编号', name: 'SerialCode', index: 'SerialCode', width: 400, align: 'center', sortable: false }
            ],
            cellsubmit: 'clientArray',
            multiselect: false,
            viewrecords: true,
            onSelectRow: function () {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
                selectRowCurIndex = $('#' + this.id).getInd(selectedRowIndex);
            },
            gridComplete: function () {
            }
        });
    }
    //添加盲板信息
    function addMB() {
        dialogOpen({
            id: "addMB",
            title: '盲板信息',
            url: '/HighRiskWork/HighRiskCommonApply/SelectMB',
            width: "660px",
            height: "200px",
            callBack: function (iframeId) {
                top.document.getElementById(iframeId).contentWindow.AcceptClick(function (options) {
                    var $gridTable = $('#gridTable1');
                    rownum = rownum + 1;

                    $gridTable.addRowData(rownum, { Id: '', Material: options.material, Specification: options.specification, SerialCode: options.serialCode });
                    $(".unwritten").hide();
                }, window.document.body);
            }
        });
    }
    //修改盲板信息
    function mb_edit(rowId) {
        var jqTable = $('#gridTable1');
        var material = jqTable.find("tr").eq(selectRowCurIndex).find("td[aria-describedby='gridTable1_Material']").attr("title");
        var specification = jqTable.find("tr").eq(selectRowCurIndex).find("td[aria-describedby='gridTable1_Specification']").attr("title");
        var serialcode = jqTable.find("tr").eq(selectRowCurIndex).find("td[aria-describedby='gridTable1_SerialCode']").attr("title");

        dialogOpen({
            id: "ScaffoldEditSpec",
            title: '编辑盲板信息',
            url: '/HighRiskWork/HighRiskCommonApply/SelectMB?material=' + material + '&specification=' + specification + '&serialcode=' + serialcode,
            width: "660px",
            height: "200px",
            callBack: function (iframeId) {
                top.document.getElementById(iframeId).contentWindow.AcceptClick(function (options) {
                    jqTable.jqGrid('setCell', rowId, 'oper', '', '');
                    jqTable.jqGrid('setCell', rowId, 'Id', '', '');
                    jqTable.jqGrid('setCell', rowId, 'Material', options.material, '');
                    jqTable.jqGrid('setCell', rowId, 'Specification', options.specification, '');
                    jqTable.jqGrid('setCell', rowId, 'SerialCode', options.serialCode, '');
                }, window.document.body);
            }
        });
    }

    //删规格
    function mb_delete(rowId) {
        $('#gridTable1').delRowData(rowId);
        var measures = $('#gridTable1').jqGrid('getRowData');
        if (measures.length == 0) {
            $(".unwritten").show();
        } else {
            $(".unwritten").hide();
        }
    }
    var isHighWork = false;
    //选择盲板抽堵作业
    function ChangeMBCDZY() {
        var workType = $("#WorkType").attr("data-value");
        if (!!isJdz && workType == "11") {
            //作业类型为"盲板抽堵作业"(景德镇版本)
            LoadMBList();
            $(".mbcdzy").show();
            $(".ckmb").hide();
            $(".gczy").hide();
            $("#WorkDutyUserName").removeAttr("isvalid");
            $("#WorkDutyUserName").removeAttr("checkexpession");
            $(".checkmb").attr("isvalid", "yes");
            $(".checkmb").attr("checkexpession", "NotNull");
            $(".td_gczy").removeAttr("isvalid");
            $(".td_gczy").removeAttr("checkexpession");
            $("#st").text("计划装盲板时间");
            $("#et").text("计划拆盲板时间");
            $("#sp_rank").text("风险等级");
            if (isHighWork == true) {
                BindRiskType("");
            }
            $("#trFile").show();
            if (isInit == false) {
                //file_upload.bindFiles(editFile, false, keyValue + "_01", 'uploader2', editFile);
                LoadMBT();
                isInit = true;
            }
            isHighWork = false;
        }
        else {
            if (!!isJdz && workType == "12") {
                //作业类型为"高处作业"(景德镇版本)
                $(".gczy").show();
                $(".td_gczy").attr("isvalid", "yes");
                $(".td_gczy").attr("checkexpession", "NotNull");
                $("#sp_rank").text("作业级别");
                if (isHighWork == false) {
                    BindRiskType("12");
                    isHighWork = true;
                }
            } else {
                $(".gczy").hide();
                $(".td_gczy").removeAttr("isvalid");
                $(".td_gczy").removeAttr("checkexpession");
                $("#sp_rank").text("风险等级");
                if (isHighWork == true) {
                    BindRiskType("");
                }
                isHighWork = false;
            }
            $(".mbcdzy").hide();
            $(".ckmb").show();
            $("#WorkDutyUserName").attr("isvalid", "yes");
            $("#WorkDutyUserName").attr("checkexpession", "NotNull");
            $(".checkmb").removeAttr("isvalid");
            $(".checkmb").removeAttr("checkexpession");
            $("#st").text("计划作业开始时间");
            $("#et").text("计划作业结束时间");
            $("#trFile").hide();
        }
    }

    function LoadMBT() {
        if (mode != "view") {
            //盲板图位置
            file_upload.init({
                keyValue: keyValue + "_01", extensions: 'jpg,gif,bmp,png,jpeg', isImage: true, el: '#uploader2'
            });
        }
        //绑定附件
        $.ajax({
            url: '../../PublicInfoManage/ResourceFile/GetFilesByRecId',
            data: { recId: keyValue + "_01" },
            type: "post",
            success: function (data) {
                var objdata = eval("(" + data + ")"); //转化为对象类型
                if (objdata.length > 0) {
                    file_upload.bind(objdata, editFile, true, keyValue + "_01", "uploader2");
                }
            }
        });
    }

    function ShowAnalyse() {
        var url = '/HighRiskWork/HighRiskCommonApply/AnalyseForm?mode=' + mode + '&keyValue=' + keyValue;
        if (mode == "show") {
            top.dlgIndex = dialogOpen({
                id: "Analyse",
                title: '作业安全分析',
                url: url,
                width: ($(top.window).width() - 300) + "px",
                height: ($(top.window).height() - 200) + "px",
                btn: ["关闭"],
                callBack: function (iframeId) {
                    top.layer.close(idx);
                }
            });
        }
        else {
            top.dlgIndex = dialogOpen({
                id: "Analyse",
                title: '作业安全分析',
                url: url,
                width: ($(top.window).width() - 300) + "px",
                height: ($(top.window).height() - 200) + "px",
                callBack: function (iframeId) {
                    top.document.getElementById(iframeId).contentWindow.AcceptClick();
                    //top.layer.close(idx);
                },
                cancel: function (index) {
                }
            });
        }
    }


</script>
<div style="margin: 0px;background-color: white;">
    <table id="form1" class="form" style="">
        <!--处理样式问题(form-button 置于最顶层，遮盖了第一行元素) 只做用作占位 start-->
        <tr>
            <td class="formTitle"></td>
            <td class="formValue" colspan="2">
                <input type="text" class="form-control" />
            </td>
            <td class="formTitle"></td>
            <td class="formValue" colspan="2">
                <input type="text" class="form-control" />
            </td>
        </tr>
        <!--处理样式问题 只做用作占位end-->
        <tr>
            <td class="formTitle">申请单位<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <!--Result记录安全措施显示形式-->
                <input type="hidden" id="Result" value="" />
                <input id="ApplyDeptName" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" disabled="disabled" />
                <input type="hidden" id="ApplyDeptId" value="" /><input type="hidden" id="ApplyDeptCode" value="" />
            </td>
            <td class="formTitle">申请人<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="ApplyUserName" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" disabled="disabled" />
                <input type="hidden" id="ApplyUserId" value="" />
            </td>
        </tr>
        <tr>
            <td class="formTitle">申请时间<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="CreateDate" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" disabled="disabled" />
            </td>
            <td class="formTitle">申请编号<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="ApplyNumber" type="text" class="form-control" placeholder="自动生成" disabled="disabled" />
            </td>
        </tr>
        <tr>
            <td class="formTitle">作业类型<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <div id="WorkType" type="select" class="ui-select" isvalid="yes" checkexpession="NotNull"></div>
            </td>
            <td class="formTitle"><span id="sp_rank">风险等级</span><font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <div id="RiskType" type="select" class="ui-select" isvalid="yes" checkexpession="NotNull" style="float:left;width:60%;"></div>
                <input type="hidden" id="RiskRecord" />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="#" id="Analyse" onclick="ShowAnalyse()" class="btn btn-primary" title='作业安全分析'><i class='fa fa-pencil-square-o'></i>作业安全分析</a>
            </td>
        </tr>
        <tr>
            <td class="formTitle" id="tddept">作业单位类别<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="WorkDeptType" id="WorkDeptType1" value="0" />单位内部
                    </label>
                </div>
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="WorkDeptType" id="WorkDeptType2" value="1" />外包单位
                    </label>
                </div>
            </td>
            <td class="formTitle">作业单位<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="WorkDeptName" type="text" class="form-control" placeholder="请选择作业单位" isvalid="yes" checkexpession="NotNull" readonly onclick="selectCompany()" />
                <input type="hidden" id="WorkDeptId" />
                <input type="hidden" id="WorkDeptCode" />
            </td>
        </tr>
        <tr>
            <td class="formTitle" id="td_title_projectname">工程名称<font face="宋体">*</font></td>
            <td class="formValue" id="td_value_projectname" colspan="2">
                <input id="EngineeringName" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" readonly placeholder="请选择工程" onclick="chooseProject();" />
                <input id="EngineeringId" type="hidden" />
            </td>
            <td class="formTitle">专业类别<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <select id="SpecialtyType" name="SpecialtyType" class="form-control" isvalid="yes" checkexpession="NotNull">
                    <option value="">请选择</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="formTitle"><span id="st">计划作业开始时间</span><font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="WorkStartTime" type="text" isvalid="yes" checkexpession="NotNull" class="form-control input-wdatepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm', maxDate: '#F{$dp.$D(\'WorkEndTime\')}' })">
            </td>
            <td class="formTitle"><span id="et">计划作业结束时间</span><font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="WorkEndTime" type="text" isvalid="yes" checkexpession="NotNull" class="form-control input-wdatepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm', minDate: '#F{$dp.$D(\'WorkStartTime\')}' })">
            </td>
        </tr>
        <tr>
            <td class="formTitle">作业区域<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                @*
                <input id="WorkAreaName" type="text" class="form-control" readonly style="width: 140px;" />*@
                <input id="WorkAreaName" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" readonly />
                <input id="WorkAreaCode" type="hidden" class="form-control" />
            </td>
        </tr>
        <tr>
            <td class="formTitle">作业地点<font face="宋体">*</font></td>
            <td class="formValue" colspan="5">
                <textarea id="WorkPlace" class="form-control" isvalid="yes" checkexpession="NotNull" style="min-height: 30px;" maxlength="100"></textarea>
            </td>
        </tr>
        <tr class="ckmb">
            <td class="formTitle">作业项目(内容)<font face="宋体">*</font></td>
            <td class="formValue" colspan="5">
                <textarea id="WorkContent" class="form-control" isvalid="yes" checkexpession="NotNull" style="min-height: 80px;" maxlength="500"></textarea>
            </td>
        </tr>
        <tr class="gczy">
            <td class="formTitle">对应工作票编号<br />及内容</td>
            <td class="formValue" colspan="5">
                <textarea id="WorkTicketNoContent" class="form-control" placeholder="请输入对应工作票编号及内容" style="min-height: 80px;" maxlength="500"></textarea>
            </td>
        </tr>
        <tr class="gczy">
            <td class="formTitle"><span id="st">工作危险分析(JHA)</span><font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input type="radio" value="1" id="yes" name="DangerAnalyse" />&nbsp;<label for="yes1">有</label>&nbsp;&nbsp;&nbsp;
                <input type="radio" value="0" id="no" name="DangerAnalyse" />&nbsp;<label for="no1">无</label>
            </td>
            <td class="formTitle"><span id="et">作业安全分析(JSA)</span><font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input type="radio" value="1" id="yes" name="SafetyAnalyse" />&nbsp;<label for="yes1">有</label>&nbsp;&nbsp;&nbsp;
                <input type="radio" value="0" id="no" name="SafetyAnalyse" />&nbsp;<label for="no1">无</label>
            </td>
        </tr>
        <tr class="gczy">
            <td class="formTitle">运行许可人<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="YXPermitUserName" type="text" class="form-control td_gczy" placeholder="请选择运行许可人" readonly onclick="chooseUser(8)" />
                <input id="YXPermitUserId" type="hidden" />
            </td>
            <td class="formTitle">值长/值班负责人<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="WatchUserName" type="text" class="form-control td_gczy" placeholder="请选择值长/值班负责人" readonly onclick="chooseUser(9)" />
                <input id="WatchUserId" type="hidden" />
            </td>
        </tr>
        <tr class="gczy">
            <td class="formTitle">受影响相关方确<br />认人</td>
            <td class="formValue" colspan="2">
                <input id="EffectConfirmerName" type="text" class="form-control" placeholder="请选择受影响相关方确认人"  onclick="chooseUser(10)" />
                <input id="EffectConfimerId" type="hidden" />
            </td>
        </tr>
        <tr class="mbcdzy">
            <td class="formTitle">设备管道名称<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="PipeLine" type="text" class="form-control checkmb" placeholder="请输入设备管道名称" maxlength="100" />
            </td>
            <td class="formTitle">介质<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="Media" type="text" class="form-control checkmb" placeholder="请输入介质" maxlength="100" />
            </td>
        </tr>
        <tr class="mbcdzy">
            <td class="formTitle">温度<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="Temperature" type="text" class="form-control checkmb" placeholder="请输入温度" maxlength="20" />
            </td>
            <td class="formTitle">压力<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="Pressure" type="text" class="form-control checkmb" placeholder="请输入压力" maxlength="20" />
            </td>
        </tr>
        <tr class="mbcdzy">
            <td class="formTitle">盲板<font face="宋体">*</font></td>
            <td class="formValue" colspan="4">
                <button id="btnAddMB" type="button" class="btn btn-primary" onclick="addMB()">新  增</button>
                <table id="gridTable1"></table>
            </td>
        </tr>
        <tr class="mbcdzy">
            <td class="formTitle">装盲板负责人<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="ZMBDutyUserName" type="text" class="form-control checkmb" placeholder="请选择装盲板负责人" readonly onclick="chooseUser(6)" />
                <input id="ZMBDutyUserId" type="hidden" />
            </td>
            <td class="formTitle">拆盲板负责人<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="CMBDutyUserName" type="text" class="form-control checkmb" placeholder="请选择拆盲板负责人" readonly onclick="chooseUser(7)" />
                <input id="CMBDutyUserId" type="hidden" />
            </td>
        </tr>
        <tr id="trElectricity" style="display:none">
            <td class="formTitle">电源接入点</td>
            <td class="formValue" colspan="2">
                <input id="PowerAccess" type="text" class="form-control">
            </td>
            <td class="formTitle">电压</td>
            <td class="formValue" colspan="2">
                <input id="Voltage" type="text" class="form-control">
            </td>
        </tr>
        <tr>
            <td class="formTitle ckmb">作业负责人<font face="宋体">*</font></td>
            <td class="formValue ckmb" colspan="2">
                <input id="WorkDutyUserName" type="text" class="form-control" placeholder="请选择作业负责人" readonly onclick="chooseUser(1)" />
                <input type="hidden" id="WorkDutyUserId" value="" />
                <input type="hidden" id="WorkDutyUserAccount" value="" />
            </td>
            <td class="formTitle">监护人<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <input id="WorkTutelageUserName" type="text" class="form-control" isvalid="yes" placeholder="请选择监护人" checkexpession="NotNull" readonly onclick="chooseUser(2)" />
                <input type="hidden" id="WorkTutelageUserId" value="" />
            </td>
        </tr>
        <tr id="tr_worklicensor">
            <td class="formTitle">作业许可人<font face="宋体">*</font></td>
            <td class="formValue" colspan="4">
                <input id="WorkLicensorName" type="text" class="form-control" isvalid="yes" placeholder="请选择作业许可人" checkexpession="NotNull" readonly onclick="chooseUser(5)" />
                <input type="hidden" id="WorkLicensorId" value="" />
                <input type="hidden" id="WorkLicensorAccount" value="" />
            </td>
            <td>
                <a id="btn_more" class="btn btn-primary" href="javascript:showmore(2);"><i class="fa fa-check"></i>&nbsp;更&nbsp;&nbsp;多</a>
            </td>
        </tr>
        <tr>
            <td class="formTitle">作业人员<font face="宋体">*</font></td>
            <td class="formValue" colspan="5">
                <input id="WorkUserNames" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" style="width:80%;display:inline;" />
                <a href="#" id="ChooseHaveCheck" onclick="chooseUser(3)" class="btn btn-primary" title='选择作业人员'><i class='fa fa-pencil-square-o'></i>选择作业人员</a>
                <a id="btn_more" class="btn btn-primary" href="javascript:showmore(0);"><i class="fa fa-check"></i>&nbsp;更&nbsp;&nbsp;多</a>
                <input type="hidden" id="WorkUserIds" value="" />
            </td>
        </tr>
        <tr>
            <td class="formTitle">抄送人</td>
            <td class="formValue" colspan="4">
                <input id="CopyUserNames" type="text" class="form-control" placeholder="请选择抄送人" readonly onclick="chooseUser(4)" />
                <input type="hidden" id="CopyUserIds" value="" />
            </td>
            <td>
                <a id="btn_more1" class="btn btn-primary" href="javascript:showmore(1);"><i class="fa fa-check"></i>&nbsp;更&nbsp;&nbsp;多</a>
            </td>
        </tr>
        <tr style="display:none">
            <td class="formTitle" id="tddept">短信通知审批人<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="IsMessage" id="IsMessage1" value="0" checked="checked" />否
                    </label>
                </div>
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="IsMessage" id="IsMessage2" value="1" />是
                    </label>
                </div>
            </td>
        </tr>
        <tr>
            <td class="formTitle" id="tddept">非工作时段审批<font face="宋体">*</font></td>
            <td class="formValue" colspan="2">
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="NonWorkingApprove" id="NonWorkingApprove1" value="0" checked="checked" />否
                    </label>
                </div>
                <div class="radio-inline">
                    <label>
                        <input type="radio" name="NonWorkingApprove" id="NonWorkingApprove2" value="1" />是
                    </label>
                </div>
            </td>
            <td class="formTitle" id="td_title_approvedept" style="display:none">审批部门<font face="宋体">*</font></td>
            <td class="formValue" colspan="2" id="td_value_approvedept" style="display:none">
                <input id="ApproveDept" type="text" class="form-control" placeholder="请选择生产值班部门"
                       readonly onclick="selectDept('', 0, 21, '请选择生产值班部门', document.body, 'ApproveDept,ApproveDeptCode,ApproveDeptId');" />
                <input type="hidden" id="ApproveDeptId" />
                <input type="hidden" id="ApproveDeptCode" />
            </td>
        </tr>
        <tr>
            <td class="formTitle">风险辨识</td>
            <td class="formValue" colspan="5">
                <textarea id="RiskIdentification" class="form-control" style="min-height: 80px;" maxlength="1000"></textarea>
            </td>
        </tr>


    </table>
    <table class="form">
        <tr id="trFile">
            <td class="formTitle">盲板图位置</td>
            <td class="formValue" colspan="5">
                
                    <div id="uploader2" class="uploader" style="border: 1px solid #ccc; margin-top: 10px; min-height: 100px; margin-bottom: 10px;">
                        <div class="queueList">
                            <div id="dndArea1" class="placeholder">
                                <div class="filePicker" style="margin-left: 25px; margin-top: 10px;"></div>
                                @*<input type="hidden" id="MBPlaceFileId" />*@
                            </div>
                        </div>
                        <div class="statusBar" style="display: none;">
                            <div class="progress">
                                <span class="text">0%</span>
                                <span class="percentage"></span>
                            </div>
                            <div class="info"></div>
                        </div>
                    </div>
              
            </td>
        </tr>
        <tr>
            <td class="formTitle">附件</td>
            <td class="formValue" colspan="5">
                <div class="ibox">
                    <div id="uploader1" class="uploader" style="border: 1px solid #ccc; margin-top: 10px; min-height: 100px; margin-bottom: 10px;">
                        <div class="queueList">
                            <div id="dndArea" class="placeholder">
                                <div class="filePicker" style="margin-left: 25px; margin-top: 10px;"></div>
                            </div>
                        </div>
                        <div class="statusBar" style="display: none;">
                            <div class="progress">
                                <span class="text">0%</span>
                                <span class="percentage"></span>
                            </div>
                            <div class="info"></div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>

    </table>

</div>
<div class="panel panel-default" id="safetyMeasure" style="display: none">
    <div class="panel-heading">
        <strong>&nbsp;&nbsp;安全措施</strong>
        <span class="tools pull-right">
            <a class="fa fa-chevron-down" title="展开/收起"></a>
        </span>
    </div>
    <div class="panel-body">
        <table id="gridMeasure"></table>
        <div id="MeasurePager"></div>
    </div>
</div>
@*<div class="panel panel-default" id="riskAnalyse">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;作业安全分析</strong>
            <span class="tools pull-right">
                <a href="javascript:selRisk()" id="select" disabled="disabled" class="btn btn-primary btn-xs">选择工作任务</a>&nbsp;&nbsp;&nbsp;&nbsp;
                <a href="javascript:addItems(this)" id="choose1" disabled="disabled" class="btn btn-primary btn-xs">新增工作任务</a>&nbsp;&nbsp;&nbsp;&nbsp; <a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <table id="gridAnalyse"></table>
            <div id="AnalysePager"></div>
        </div>
    </div>*@
<div class="form-button" style="top: 40px; text-align: left; padding-left: 20px; position: fixed; bottom: auto; z-index: 1000;">
    <div style="float: left;">
        <a id="btn_Save" class="btn btn-primary"><i class="fa fa-check"></i>&nbsp;保&nbsp;&nbsp;存</a>
        &nbsp; &nbsp;
        <a id="btn_Submit" class="btn btn-primary"><i class="fa fa-mail-forward"></i>&nbsp;提&nbsp;&nbsp;交</a>
        &nbsp; &nbsp;
    </div>
</div>
<div class="modal" id="QdModal">
    <div class="modal-dialog" style="width: 300px; margin-top: 100px;">
        <div class="modal-content" style="text-align: center;">
            <div class="modal-header">
                <h5>人员</h5>
            </div>
            <div class="modal-body" id="modalBody" style="word-break:break-all">
            </div>
            <div class="modal-footer">
                <button id="btnModal" type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
