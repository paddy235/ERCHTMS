@{;
ViewBag.Title = "表单页面";
Layout = "~/Views/Shared/_Form.cshtml";
}

<script src="~/Content/scripts/plugins/ckeditor/ckeditor.js"></script>
<script src="~/Content/scripts/plugins/simditor/js/module.min.js"></script>
<script src="~/Content/scripts/plugins/simditor/js/uploader.min.js"></script>
<script src="~/Content/scripts/plugins/simditor/js/hotkeys.min.js"></script>
<link href="~/Content/scripts/plugins/cxColor/css/jquery.cxcolor.css" rel="stylesheet" />
<script src="~/Content/scripts/plugins/cxColor/js/jquery.cxcolor.js"></script>
<script type="text/javascript" src="~/content/scripts/business/common.js"></script>
<!--webUploader文件上传组件-->
<link href="~/content/scripts/plugins/webuploader/webuploader.css" rel="stylesheet" />
<link href="~/content/scripts/plugins/webuploader/webuploader-demo.css" rel="stylesheet" />
<script type="text/javascript" src="~/content/scripts/plugins/webuploader/webuploader.min.js"></script>
<script type="text/javascript" src="~/content/scripts/business/fileupload.js"></script>
<style>
    .form .formTitle {
        width: 110px;
    }

    .form .formValue select {
        padding: 0px;
    }
</style>
<script>
    var rolename = '@ERCHTMS.Code.OperatorProvider.Provider.Current().RoleName';
    var userid = '@ERCHTMS.Code.OperatorProvider.Provider.Current().UserId';
    var username = '@ERCHTMS.Code.OperatorProvider.Provider.Current().UserName';
    var deptid = '@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptId';
    var deptcode = '@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptCode';
    var deptname = '@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptName';
    var mode = request('mode');
    var keyValue = request('keyValue');          //主键ID
    var scaffoldtype = request('scaffoldtype');  //0-搭设申请 1-验收申请 2-拆除申请
    var auditstate = 0;                          //作业状态
    var cur_auditstate = 0;                      //当前申请信息的实际状态
    var rownum = 1;                              //行数
    var selectRowCurIndex;                       //当前选中行下标
    var flag = false;
    var curflowid = "";
    $(function () {
        GetGrid();
        loadAuditList();
        initControl();

    });
    //加载安全措施
    function LoadMeasureList() {
        //新增-只是显示 提交-保存安全措施数据
        //如果状态为验收中，则显示可操作安全措施配置项
        var queryJson;
        var url = "";
        var colModel = [];
        if (!mode.includes('add')) {
            queryJson = {
                scaffoldid: keyValue
            }
            url = "../../HighRiskWork/HighRiskCommonApply/GetMeasureListJson";
            colModel = [
                { label: '主键', name: 'Id', hidden: true },
                { label: '项目ID', name: 'ProjectId', hidden: true },
                 { label: '符合', name: 'ResultYes', hidden: true },
                  { label: '不符合', name: 'ResultNo', hidden: true },
                { label: '验收项目', name: 'ProjectName', index: 'ProjectName', width: 500, align: 'center', sortable: false },
                {
                    label: '验收结果', name: 'Result', index: 'Result', width: 200, align: 'center', sortable: true,
                    formatter: function (cellvalue, options, rowObject) {

                        if (!!rowObject.Id) {
                            var yVal = "";
                            var wVal = "";
                            var disabledhtml = "  ";
                            var displayStr = " ";
                            if (!!rowObject.Result) {
                                if (rowObject.Result == "1") {
                                    yVal = " checked = \"checked\"";
                                }
                                if (rowObject.Result == "0") {
                                    wVal = " checked = \"checked\"";
                                }
                            }
                            if (mode == "view" || cur_auditstate != 4) {
                                disabledhtml = "  disabled=\"disabled\"  ";
                            }
                            var html = "<input type=\"radio\" onclick=\"changeState('" + rowObject.Id + "',this)\" name=\"result_" + rowObject.Id + "\" " + yVal + disabledhtml + " value=\"1\">" + rowObject.ResultYes + "&nbsp;";
                            html += "<input type=\"radio\" onclick=\"changeState('" + rowObject.Id + "',this)\"  name=\"result_" + rowObject.Id + "\" " + wVal + disabledhtml + " value=\"0\">" + rowObject.ResultNo + "&nbsp;";

                            return html;
                        }
                    }
                },
                {
                    label: '验收人', name: 'CheckPersons', index: 'CheckPersons', width: 200, align: 'center', sortable: true,
                    formatter: function (cellvalue, options, rowObject) {
                        if (!!rowObject.Id) {

                            var disabledhtml = "  ";
                            var content = !!rowObject.CheckPersons ? rowObject.CheckPersons : "";
                            if (mode == "view" || cur_auditstate != 4) {
                                disabledhtml = "  disabled=\"disabled\"  ";
                            }
                            if (mode == "view" || cur_auditstate == 0) {
                                displayStr = ' style="display:none" ';
                            }
                            var html = "<input type=\"text\" readonly  style=\"width:200px;\" id=\"people_" + rowObject.Id + "\" value=\"" + content + "\" " + disabledhtml + ">&nbsp;";

                            return html;
                        }
                    }
                },
                {
                    label: '确认人', name: 'CheckPersonsId', width: 100, align: 'center', hidden: true, formatter: function (cellvalue, options, rowObject) {
                        if (!!rowObject.id) {
                            var disabledhtml = "  ";
                            var content = !!rowObject.CheckPersonsId ? rowObject.CheckPersonsId : "";
                            var html = "<input type=\"hidden\"  id=\"peopleid_" + rowObject.id + "\" value=\"" + content + "\">&nbsp;";
                            return html;
                        }

                    }
                },
                {
                    label: '签名', name: 'SignPic', index: 'SignPic', width: 100, align: 'center', sortable: false,
                    formatter: function (cellvalue, options, rowObject) {
                        if (!!rowObject.Id) {
                            var disabledhtml = "  ";
                            var content = !!rowObject.SignPic ? rowObject.SignPic : "";
                            var html = "";
                            if (content == "" || content == undefined) {
                                var html = "<img style=\"height:50px;\"  id=\"sign_" + rowObject.Id + "\" >&nbsp;";
                            } else {
                                html = "<img style=\"height:50px;\" id=\"sign_" + rowObject.Id + "\" src=\"../.." + content + "\">&nbsp;";
                            }
                            return html;
                        }

                    }
                }];
        } else {
            queryJson = { queryJson: JSON.stringify({ code: "-1" }) };
            url = "../../HighRiskWork/HighProjectSet/GetPageListJson";
            colModel = [
                { label: '主键', name: 'id', width: 10, align: 'left', sortable: true, hidden: true },
                { label: '验收项目', name: 'measurename', index: 'measurename', width: 500, align: 'center', sortable: false },
                {
                    label: '验收结果', name: 'measureresult', index: 'measureresult', width: 200, align: 'center', sortable: false, formatter: function (cellvalue, options, rowObject) {
                        var html = '<input type="radio" name="ResultYes" id="ResultYes" value="0" disabled="disabled"/>' + rowObject.measureresultone + '&nbsp;&nbsp;&nbsp; <input type="radio" name="ResultYes" id="ResultNo" value="1" disabled="disabled" />' + rowObject.measureresulttwo + '';
                        return html;
                    }
                },
                { label: '验收结果1', name: 'measureresultone', width: 10, align: 'left', sortable: true, hidden: true },
                { label: '验收结果2', name: 'measureresulttwo', width: 10, align: 'left', sortable: true, hidden: true }

            ];
        }

        var selectedRowIndex = 0;
        var $gridTable = $('#gridMeasure');
        $gridTable.jqGrid({
            autowidth: true,
            height: 350,
            url: url,
            postData: queryJson,
            datatype: "json",
            colModel: colModel,
            viewrecords: true,
            rownumbers: true,
            shrinkToFit: false,
            gridview: true,
            onSelectRow: function () {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
            }
        });

    }
    //赋值确定人
    function changeState(id, obj) {
        var signImg = getUserSignPic(userid);
        if (!!signImg) {
            $("#sign_" + id).attr("src", "../.." + signImg);
            $("#people_" + id).val(username);
            $("#peopleid_" + id).val(userid);
        } else {
            $(obj).get(0).checked = false;
        }
    }

    //加载架体规格及形式表格
    function GetGrid() {
        var selectedRowIndex = 0;
        var $gridTable = $('#ScaffoldSpec');
        $gridTable.jqGrid({
            autowidth: true,
            height: 'auto',
            url: "../../HighRiskWork/Scaffold/GetScaffSpecToJson?scaffoldid=" + keyValue,
            postData: {},
            datatype: "json",
            colModel: [
                { label: '规格ID', name: 'Id', hidden: true, align: 'center' },
                { label: '脚手架信息ID', name: 'ScaffoldId', hidden: true, align: 'center' },
                { label: '长(m)', name: 'SLength', width: '100', align: 'center', sortable: false, },
                { label: '宽(m)', name: 'SWidth', width: '100', align: 'center', sortable: false, },
                { label: '高(m)', name: 'SHigh', width: '100', align: 'center', sortable: false, },
                { label: '架体形式', name: 'SFrameName', align: 'center', sortable: false, },
                { label: '架体形式ID', name: 'SFrameId', hidden: true, align: 'center' },
            ],
            cellsubmit: 'clientArray',
            multiselect: false,
            viewrecords: true,
            onSelectRow: function () {
                selectedRowIndex = $('#' + this.id).getGridParam('selrow');
                selectRowCurIndex = $('#' + this.id).getInd(selectedRowIndex);
            },
            gridComplete: function () {
                $('#' + this.id).setSelection(selectedRowIndex, false);
                if (!rownum) {
                    rownum = $gridTable.jqGrid('getRowData').length;
                }
            }
        });
    }
    //加载审核记录
    function loadAuditList() {
        //-审核记录
        var $gridTable = $('#ScaffoldAudit');
        $gridTable.jqGrid({
            autowidth: true,
            height: 'auto',
            url: "../../HighRiskWork/Scaffold/GetScaffAuditToJson?scaffoldid=" + keyValue,
            postData: {},
            datatype: "json",
            colModel: [
                { label: '审核部门', name: 'AuditDeptName', width: '110', sortable: false, align: 'center' },
                { label: '审核人', name: 'AuditUserName', width: '110', sortable: false, align: 'center' },
                {
                    label: '审核时间', name: 'AuditDate', width: '110', sortable: false, align: 'center', formatter: function (cellvalue, options, rowObject) {
                        return formatDate(rowObject.AuditDate, 'yyyy-MM-dd hh:mm');
                    }
                },
                {
                    label: '审核结果', name: 'AuditState', width: '100', sortable: false, align: 'center', formatter: function (cellvalue, options, rowObject) {
                        if (rowObject.AuditState == 1)
                            return "同意";
                        return "不同意";
                    }
                },
                { label: '审核意见', name: 'AuditRemark', width: '100', sortable: false, align: 'center' },
                {
                    label: '签名', name: 'AuditSignImg', index: 'AuditSignImg', width: 150, align: 'center',
                    formatter: function (cellvalue, options, rowObject) {
                        var content = !!rowObject.AuditSignImg ? rowObject.AuditSignImg : "";
                        var html = "";
                        if (content == "" || content == undefined) {
                            var html = "<img  style=\"height:50px;\" />&nbsp;";
                        } else {
                            html = "<img style=\"height:50px;\"  src=\"../.." + content + "\"/>&nbsp;";
                        }

                        return html;
                    }
                }
            ],
            cellsubmit: 'clientArray',
            multiselect: false,
            viewrecords: true,
            onSelectRow: function () {
            },
            gridComplete: function () {
            }
        });
    }

    //初始化控件
    function initControl() {

        ////专业分类
        //$("#SpecialtyType").ComboBox({
        //    param: { EnCode: "SpecialtyType" },
        //    url: "../../SystemManage/DataItemDetail/GetDataItemListJson",
        //    description: "======请选择======",
        //    id: "ItemValue",
        //    text: "ItemName",
        //    height: "230px"
        //});

        //脚手架类型
        $("#SetupType").ComboBox({
            param: { EnCode: "ScaffoldType" },
            url: "../../SystemManage/DataItemDetail/GetDataItemListJson",
            description: "======请选择======",
            id: "ItemValue",
            text: "ItemName",
            height: "230px"
        }).change(function () {
            $("#SetupInfoId").val("");
            $("#SetupInfoCode").val("");
            $("#SetupCompanyType1").removeAttr("disabled");
            $("#SetupCompanyType2").removeAttr("disabled");
            $("#SetupCompanyId").val("").removeAttr("disabled");
            $("#SetupCompanyCode").val("").removeAttr("disabled");
            $("#SetupCompanyName").val("").removeAttr("disabled");
            $("#SetupStartDate").val("").removeAttr("disabled");
            $("#SetupEndDate").val("").removeAttr("disabled");
            $("#SetupAddress,#SetupChargePerson,#Purpose,#Parameter").val("").removeAttr("disabled");
            $("#SpecialtyType").html('');
            $("#SpecialtyType").append('<option value="">请选择</option>');
            if ($("#SetupCompanyType").val() == "1") {
                $("#OutProjectName").val("");
                $("#OutProjectId").val("");
                //给工程名称赋验证
                $("#OutProjectName").attr("checkexpession", "NotNull").attr("isvalid", "yes");
                $("#OutProjectName").removeAttr("disabled");
            }
            //架体规格级形式
            var $gridTable = $('#ScaffoldSpec');
            $gridTable.clearGridData();
        });

        //获取表单
        if (!!keyValue) {
            $.SetForm({
                url: "../../HighRiskWork/Scaffold/GetFormJson",
                param: { keyValue: keyValue },
                success: function (data) {
                    $("#form1").formDeserialize(data);
                    cur_auditstate = data.AuditState;
                    //页面加载时，控制工程名称显示
                    if (data.SetupCompanyType == 1) {
                        $("#td_title_projectname").show();
                        $("#td_value_projectname").show();
                        $("#SetupCompanyType2").attr("checked", "checked");
                        $("#OutProjectName").attr("checkexpession", "NotNull").attr("isvalid", "yes");
                        GetSpecialty(data.OutProjectId, data.SpecialtyType);
                    }
                    else {
                        $("#td_title_projectname").hide();
                        $("#td_value_projectname").hide();
                        $("#SetupCompanyType1").attr("checked", "checked");
                        $("#OutProjectName").removeAttr("checkexpession").removeAttr("isvalid");
                        GetSpecialty(data.SetupCompanyId, data.SpecialtyType);
                    }
                    //页面加载时，判断脚手架信息ID是否为空，不为空，则把相关字段禁用
                    if (data.SetupInfoId) {
                        $("#panel_info input,textarea,select, .ui-select, .ui-select-text , .ui-select-option-content").each(function (index, ele) {
                            if (ele.id == "SetupInfoCode" || ele.id.includes("AuditRemark") || ele.id == "ActSetupStartDate" || ele.id == "ActSetupEndDate" || ele.id == "SpecialtyType") {
                            } else {
                                $(ele).attr("disabled", "disabled");
                            }
                        });
                    }

                    curflowid = data.FlowId;

                    //验收中时，此按钮才显示(验收保存)
                    if (cur_auditstate == 4) {
                        $("#btn_AuditSave").show();
                    } else {
                        $("#btn_AuditSave").hide();
                    }
                    //流程结束后显示导出按钮(流程不通过或通过)
                    if (data.AuditState == 2 || data.AuditState == 3 || data.AuditState == 5) {
                        $("#btn_Export").show();
                    } else {
                        $("#btn_Export").hide();
                    }

                    //加载表单后再加载验收项目
                    LoadMeasureList();
                }
            })
        } else {
            keyValue = "@Guid.NewGuid().ToString()";

            //页面加载时，控制工程名称显示
            if (rolename.indexOf("承包商") >= 0 || rolename.indexOf("分包商") >= 0) {
                $("#td_title_projectname").show();
                $("#td_value_projectname").show();

                $("#SetupCompanyType").val("1");
                $("#SetupCompanyType1").prop("checked", false).attr("disabled", "disabled");
                $("#SetupCompanyType2").prop("checked", true).attr("disabled", "disabled");
            }
            else {
                $("#td_title_projectname").hide();
                $("#td_value_projectname").hide();
                $("#SetupCompanyType").val("0");
                $("#OutProjectName").removeAttr("checkexpession").removeAttr("isvalid");
            }
            LoadMeasureList();
        }
        //查看
        if (mode == "view") {
            $("#btn_Save").css("display", "none");
            $("#btn_Submit").css("display", "none");
            $("#btn_Audit").css("display", "none");
            $("#btn_Transfer").css("display", "none");
            $("#btn_AuditSave").css("display", "none");
            $("#form1 input,textarea,select, .ui-select, .ui-select-text , .ui-select-option-content").each(function (ele, index) {
                $(this).attr("disabled", "disabled");
            });

            $("#panel_auditrecord").show();
            $("#panel_audit").hide();

        } else if (mode == "audit") {

            $("#AuditUserId").val(userid);
            $("#AuditUserName").val(username);
            $("#AuditDeptId").val(deptid);
            $("#AuditDeptCode").val(deptcode);
            $("#AuditDeptName").val(deptname);
            $("#ScaffoldId").val(keyValue);

            $("#btn_Save").css("display", "none");
            $("#btn_Submit").css("display", "none");
            $("#panel_info input,#panel_info textarea,#panel_info select, .ui-select, .ui-select-text , .ui-select-option-content").each(function (ele, index) {
                $(this).attr("disabled", "disabled");
            });

            //控制验收项目和审核流程显示，二者不能同时存在
            if (cur_auditstate == 4) {
                //是否可上传
                flag = true;
                $("#panel_audit").hide();
            } else {
                $("#panel_audit").show();
            }
            $("#panel_auditrecord").show();
        } else {
            $("#btn_Audit").css("display", "none");
            $("#btn_Transfer").css("display", "none");
            $("#btn_AuditSave").css("display", "none");
            $("#btn_Export").hide();
            $("#panel_audit").hide();
            $("#panel_auditrecord").hide();
        }

        //在验收时才可以操作
        file_upload.init({
            keyValue: keyValue + "_acceptfileid", extensions: 'jpg,gif,bmp,png', isImage: false, el: '#uploader_accept'
        });
        file_upload.bindFiles(flag, false, keyValue + "_acceptfileid", 'uploader_accept', flag);

        //选择搭设单位类别时，控制工程名称显示
        $("input[name='SetupCompanyType']").click(function () {
            if ($(this).val() == "0") {
                $("#td_title_projectname").hide();
                $("#td_value_projectname").hide();
                $("#OutProjectName").removeAttr("checkexpession").removeAttr("isvalid");
            } else {
                $("#td_title_projectname").show();
                $("#td_value_projectname").show();
                $("#OutProjectName").attr("checkexpession", "NotNull").attr("isvalid", "yes");
            }
            //清空搭设单位值
            $("#SetupCompanyName,#SetupCompanyCode,#SetupCompanyId,#OutProjectId,#OutProjectName").val("");
            $("#SpecialtyType").html("");
            $("#SpecialtyType").append('<option value="">请选择</option>');
            $("#SetupCompanyType").val($(this).val());


        });

        //脚手架类型切换时，清空

        //申请类型
        $("#ScaffoldType").val(scaffoldtype);


        $("#btn_Save").click(function () {
            auditstate = 0;
            AcceptClick();
        });
        $("#btn_Submit").click(function () {
            auditstate = 1;
            AcceptClick();
        });

        //审批转交
        $("#btn_Transfer").click(function () {
            TransferAction();
        });
    }

    //选择脚手架信息
    function selectScaffold() {
        var setuptype = $("#SetupType").attr("data-value");
        var setupcompanytype = $("#SetupCompanyType").val();
        if (!setuptype) {
            dialogMsg('请先选择脚手架搭设类型！', 0);
            return;
        }
        dialogOpen({
            id: "SelectScaffold",
            title: '选择关联的脚手架搭设申请信息',
            url: '/HighRiskWork/Scaffold/SelectScaffold?setuptype=' + setuptype + '&scaffoldtype=' + scaffoldtype + '&companytype=' + setupcompanytype,
            width: "1200px",
            height: "500px",
            callBack: function (iframeId) {
                top.document.getElementById(iframeId).contentWindow.AcceptClick(function (keyValue) {
                    $.SetForm({
                        url: "../../HighRiskWork/Scaffold/GetFormJson",
                        param: { keyValue: keyValue },
                        success: function (data) {
                            $("#SetupCompanyType1").attr("disabled", "disabled");
                            $("#SetupCompanyType2").attr("disabled", "disabled");
                            $("#SetupCompanyType").val(data.SetupCompanyType).attr("disabled", "disabled"); //搭设单位类别
                            $("#SetupCompanyName").val(data.SetupCompanyName).attr("disabled", "disabled"); //搭设单位名称
                            $("#SetupCompanyCode").val(data.SetupCompanyCode).attr("disabled", "disabled"); //搭设单位代码
                            $("#SetupCompanyId").val(data.SetupCompanyId).attr("disabled", "disabled"); //搭设单位Id
                            $("#SetupCompanyName1").val(data.SetupCompanyName1).attr("disabled", "disabled"); //搭设单位名称
                            $("#SetupCompanyCode1").val(data.SetupCompanyCode1).attr("disabled", "disabled"); //搭设单位代码
                            $("#SetupCompanyId1").val(data.SetupCompanyId1).attr("disabled", "disabled"); //搭设单位Id
                            $("#SetupStartDate").val(data.SetupStartDate).attr("disabled", "disabled"); //搭设时间
                            $("#SetupEndDate").val(data.SetupEndDate).attr("disabled", "disabled"); //搭设时间
                            if (!!data.ActSetupStartDate) {
                                $("#ActSetupStartDate").val(data.ActSetupStartDate);//实际搭设时间
                                $("#ActSetupStartDate").attr("disabled", "disabled");
                            }
                            if (!!data.ActSetupEndDate) {
                                $("#ActSetupEndDate").val(data.ActSetupEndDate);//实际搭设时间
                                $("#ActSetupEndDate").attr("disabled", "disabled");
                            }
                            $("#WorkArea").val(data.WorkArea).attr("disabled", "disabled"); //作业区域
                            $("#WorkAreaCode").val(data.WorkAreaCode);//作业区域Code
                            $("#SetupAddress").val(data.SetupAddress).attr("disabled", "disabled"); //搭设地点
                            $("#SetupChargePerson").val(data.SetupChargePerson).attr("disabled", "disabled")  //搭设负责人
                            $("#SetupChargePersonIds").val(data.SetupChargePersonIds).attr("disabled", "disabled")  //搭设负责人ID
                            $("#Purpose").val(data.Purpose).attr("disabled", "disabled"); //用途
                            $("#Parameter").val(data.Parameter).attr("disabled", "disabled"); //脚手架参数
                            $("#SetupInfoCode").val(data.ApplyCode);     //脚手架信息
                            $("#SetupInfoId").val(data.Id);  //脚手架信息ID
                            $("#SetupPersonIds").val(data.SetupPersonIds); //搭设人员Id
                            $("#SetupPersons").val(data.SetupPersons); //搭设人员

                            //页面加载时，控制工程名称显示
                            if (data.SetupCompanyType == 1) {
                                $("#td_title_projectname").show();
                                $("#td_value_projectname").show();
                                $("#SetupCompanyType2").attr("checked", "checked");
                                $("#OutProjectName").val(data.OutProjectName);
                                $("#OutProjectId").val(data.OutProjectId);
                                $("#OutProjectName").attr("checkexpession", "NotNull").attr("isvalid", "yes");
                                $("#OutProjectName").attr("disabled", "disabled");
                                GetSpecialty(data.OutProjectId, data.SpecialtyType);
                            }
                            else {
                                $("#td_title_projectname").hide();
                                $("#td_value_projectname").hide();
                                $("#SetupCompanyType1").attr("checked", "checked");
                                GetSpecialty(data.SetupCompanyId, data.SpecialtyType);
                            }

                            //架体规格级形式
                            var $gridTable = $('#ScaffoldSpec');
                            $gridTable.clearGridData();
                            if (data.ScaffoldSpecs && data.ScaffoldSpecs.length > 0) {
                                for (var i = 0; i < data.ScaffoldSpecs.length; i++) {
                                    var spec = data.ScaffoldSpecs[i];
                                    rownum = rownum + 1;
                                    $gridTable.addRowData(rownum, { Id: '', ScaffoldId: data.Id, SLength: spec.SLength, SWidth: spec.SWidth, SHigh: spec.SHigh, SFrameName: spec.SFrameName, SFrameId: spec.SFrameId });
                                }
                                $(".unwritten").hide();
                            }
                        }
                    })
                });
            }
        });
    }

    //选择使用单位
    function selectCompany() {
        var flag = false;
        var setupcompanytype = $("input[name='SetupCompanyType']:checked").val();
        /**
        1.选择单位内部时，工程名称隐藏,当前角色为“厂级部门”，搭设单位为所有单位，否则为搭设单位本部门及以下单位。
        2.选择外包单位时，工程名称显示,当前角色为“厂级部门”，搭设单位为所有外包单位,否则搭设单位为本部门及以下级部门管辖的外包单位。
        3.另工程名称为选择搭设单位后单位管辖的工程，选择工程后把作业区域代入文本框。
        **/
        if (setupcompanytype == "0") {
            selectDept('&type=highrisk', 0, 4, '选择使用单位', document.body, 'SetupCompanyName,SetupCompanyCode,SetupCompanyId', "", function () {
                $("#SetupCompanyName1").val($("#SetupCompanyName").val());
                $("#SetupCompanyCode1").val($("#SetupCompanyCode").val());
                $("#SetupCompanyId1").val($("#SetupCompanyId").val());
                var departid = $("#SetupCompanyId").val();
                $("#SpecialtyType").html('');
                $("#SpecialtyType").append('<option value="">请选择</option>');
                GetSpecialty(departid, "");

            });
        } else {
            selectDept('', 0, 7, '选择使用单位', document.body, 'SetupCompanyName,SetupCompanyCode,SetupCompanyId', "1", function () {
                $("#SpecialtyType").html('');
                $("#SpecialtyType").append('<option value="">请选择</option>');
                $("#OutProjectId,#OutProjectName").val("");
            });
        }
    }

    //人员查看更多
    function showmore() {
        if (!!$("#CopyUserNames").val()) {
            var html = $("#CopyUserNames").val();
            $("#modeltitle").html("抄送人员");
            $("#modalBody").html(html);
            $("#QdModal").modal('show');
        }
        else {
            dialogMsg('请选择抄送人员！', 0);
        }
    }

    function TransferAction() {
        var url = '/HighRiskWork/HighRiskCommonApply/TransferForm?keyValue=' + keyValue + "&FlowId=" + curflowid;
        idx = dialogOpen({
            id: "Transfer",
            title: '审批转交',
            url: url,
            width: ($(top.window).width() * 0.4) + "px",
            height: ($(top.window).height() * 0.4) + "px",
            callBack: function (iframeId) {
                top.document.getElementById(iframeId).contentWindow.AcceptClick();
                //top.layer.close(idx);
                //$.currentIframe().$("#gridTable").trigger("reloadGrid");
            },
            cancel: function (index) {
            }
        });
    }

    //选择搭设单位
    function selectCompany1() {
        selectDept('', 0, 0, '选择搭设单位', document.body, 'SetupCompanyName1,SetupCompanyCode1,SetupCompanyId1');
    }

    //获取部门下的专业类别
    function GetSpecialty(departid, stype) {
        var specialtytype = stype;
        if (mode == "edit" || mode == "add") {
            specialtytype = "";
        }
        var workdepttype = $("input[name='SetupCompanyType']:checked").val();
        var flag = false;
        $.ajax({
            url: "../../HighRiskWork/Scaffold/GetSpecialtyToJson?deptid=" + departid + "&specialtytype=" + specialtytype + "&workdepttype=" + workdepttype,
            asycn: true,
            type: 'get',
            success: function (data) {
                if (!!data) {
                    var json = JSON.parse(data);
                    for (var i = 0; i < json.length; i++) {
                        if (stype == json[i].itemvalue) {
                            $("#SpecialtyType").append('<option value="' + json[i].itemvalue + '" selected="selected">' + json[i].itemname + '</option>');
                        }
                        else {
                            $("#SpecialtyType").append('<option value="' + json[i].itemvalue + '">' + json[i].itemname + '</option>');
                        }
                    }
                }
            }
        });
    }
    //获取工程详情
    function GetEngineerInfo(id) {
        $.SetForm({
            url: "../../OutsourcingProject/Outsouringengineer/GetFormJson?keyValue=" + id,
            success: function (data) {
                $("#WorkArea").val(data.data.ENGINEERAREANAME);
            }
        })
    }
    //保存表单;
    function AcceptClick() {
        if (!$('#form1').Validform()) {
            return false;
        }
        var postData = $("#form1").formSerialize(keyValue);
        postData["SetupTypeName"] = $("#SetupType").attr("data-text");
        var $gridTable = $('#ScaffoldSpec');
        //架体规格数据
        var measures = $gridTable.jqGrid('getRowData');
        if (measures.length == 0) {
            dialogMsg('请添加架体规格及形式！', 0);
            return false;
        }
        for (var i = 0; i < measures.length; i++) {
            delete measures[i].operat;
            measures[i].ScaffoldId = keyValue;
        }
        postData["ScaffoldSpecs"] = measures;
        postData["AuditState"] = auditstate;

        $.SaveForm({
            url: "../../HighRiskWork/Scaffold/SaveForm?keyValue=" + keyValue,
            param: { jsonData: JSON.stringify(postData) },
            loading: "正在保存数据...",
            success: function () {
                $.currentIframe().$("#gridTable").trigger("reloadGrid");
            }
        })
    }

    //验收项目保存
    function AuditSave() {
        //处理验收项目
        var measures = $('#gridMeasure').jqGrid('getRowData');
        var projects = [];
        for (var i = 0; i < measures.length; i++) {
            var item = measures[i];
            var curId = item.Id;
            var domId = "#people_" + curId;
            var ppId = "#peopleid_" + curId;
            var signid = "#sign_" + curId;
            var result = $("input[name='result_" + curId + "']:checked").val();
            var person = $(domId).val();

            result = !!result ? result : "";
            var people = $(domId).val();
            people = !!people ? people : "";
            var peopleid = $(ppId).val();//人员Id
            peopleid = !!peopleid ? peopleid : "";
            var signpic = $(signid).attr("src");//签名
            signpic = !!signpic ? signpic : "";

            projects.push({ Id: curId, ProjectId: item.ProjectId, ProjectName: item.ProjectName, CheckPersons: person, CheckPersonsId: peopleid, SignPic: signpic, Result: result, ResultYes: item.ResultYes, ResultNo: item.ResultNo, ScaffoldId: item.ScaffoldId });

        }
        $.SaveForm({
            url: "../../HighRiskWork/Scaffold/AuditSave?keyValue=" + keyValue,
            param: { jsonData: JSON.stringify(projects) },
            loading: "正在保存数据...",
            success: function () {
                $.currentIframe().$("#gridTable").trigger("reloadGrid");
            }
        });

    }
    //审核提交
    function AuditSubmit() {
        if (!$('#form1').Validform()) {
            return false;
        }
        var auditresult = $("input[name='AuditState']:checked").val();
        if (cur_auditstate != 4) {
            //审核结果
            if (auditresult == "" || auditresult == undefined) {
                dialogAlert("审核结果未勾选,无法进行提交!!!", function () {
                    return false;
                })
                return false;
            }
        }
        else {
            auditresult = 1;
        }
        //审核信息组装
        var postData = postData = {
            ScaffoldId: $("#ScaffoldId").val(),
            AuditUserId: $("#AuditUserId").val(),
            AuditUserName: $("#AuditUserName").val(),
            AuditDeptId: $("#AuditDeptId").val(),
            AuditDeptName: $("#AuditDeptName").val(),
            AuditDeptCode: $("#AuditDeptCode").val(),
            AuditRemark: $("#AuditRemark").val(),
            AuditDate: $("#AuditDate").val(),
            AuditState: auditresult,
            AuditSignImg: $("#AuditSignImg").attr("src")
        };
        var isnodone = 0;
        var isempty = 0;
        var resultArr = new Array();
        //当前申请状态为“验收中”，且角色为专工时
        if (cur_auditstate == 4) {
            var $gridTable = $('#gridMeasure');
            var measures = $gridTable.jqGrid('getRowData');
            for (var i = 0; i < measures.length; i++) {
                var curId = measures[i].Id;
                var domId = "#people_" + curId;
                var ppId = "#peopleid_" + curId;
                var signid = "#sign_" + curId;
                var result = $("input[name='result_" + curId + "']:checked").val();

                if (!!result && result == "0") {
                    isnodone += 1;
                }
                if (!result) {
                    isempty += 1;
                }
                result = !!result ? result : "";
                var people = $(domId).val();
                people = !!people ? people : "";
                var peopleid = $(ppId).val();//人员Id
                peopleid = !!peopleid ? peopleid : "";
                var signpic = $(signid).attr("src");//签名
                signpic = !!signpic ? signpic : "";

                var domidproject = "#projectname_" + curId;
                projectname = $(domidproject).val();

                var curObj = {
                    Id: curId,
                    Result: result,
                    CheckPersons: people,
                    projectid: measures[i].ProjectId,
                    ProjectName: measures[i].ProjectName,
                    ScaffoldId: measures[i].ScaffoldId,
                    ResultYes: measures[i].ResultYes,
                    ResultNo: measures[i].ResultNo,
                    CheckPersonsId: peopleid,
                    SignPic: signpic
                };
                resultArr.push(curObj);

            }
            if (isempty == 0 && isnodone == 0) {
                postData["AuditRemark"] = "验收项目全部通过";
            }
        }
        if (isempty > 0) {
            dialogMsg("验收项目有未设置的项,无法进行提交!", 0);
            return false;
        }
            //存在未完成的
        else if (isnodone > 0) {
            dialogConfirm("验收项目有验收不符的项,提交将会结束流程,确定提交?", function (res) {
                if (res) {

                    postData["AuditRemark"] = "验收项目有验收不符的项";
                    postData["AuditState"] = 0;

                    $.SaveForm({
                        url: "../../HighRiskWork/Scaffold/AuditSubmit?keyValue=" + keyValue,
                        param: { jsonData: JSON.stringify({ auditEntity: postData, projects: resultArr }) },
                        loading: "正在保存数据...",
                        success: function () {
                            $.currentIframe().$("#gridTable").trigger("reloadGrid");
                        }
                    })
                }
            });
            return false;
        } else {
            $.SaveForm({
                url: "../../HighRiskWork/Scaffold/AuditSubmit?keyValue=" + keyValue,
                param: { jsonData: JSON.stringify({ auditEntity: postData, projects: resultArr, checktype: auditstate == 4 ? 1 : 0 }) },
                loading: "正在保存数据...",
                success: function () {
                    $.currentIframe().$("#gridTable").trigger("reloadGrid");
                    top.refreshWork();//刷新首页待办事项
                }
            })
        }

    }
    //导出
    function ExportDoc() {
        location.href = "../../HighRiskWork/Scaffold/ExportDoc?keyValue=" + keyValue;
    }

    function auditCheck(obj) {
        var signImg = getUserSignPic(userid);
        if (!!signImg) {
            $("#AuditSignImg").attr("src", "../.." + signImg);
        } else {
            $(obj).get(0).checked = false;
        }
    }

    //选择工程
    function chooseProject() {
        if (!!$("#SetupCompanyName").val()) {
            SelectOutProject(window.document.body, 'OutProjectName,OutProjectId', $("#SetupCompanyId").val(), function () {
                var outprojectid = $("#OutProjectId").val()
                $("#SpecialtyType").html('');
                $("#SpecialtyType").append('<option value="">请选择</option>');
                GetSpecialty(outprojectid, "");
                //GetEngineerInfo($("#OutProjectId").val());
            });
        }
        else {
            dialogMsg('请先选择使用单位！', 0);
        }
    }
</script>
<div style="margin:0px 5px;">
    <div id="div1" style="margin-top: 50px;"></div>
    <div id="panel_info" class="panel panel-default">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;验收申请基本信息</strong>
            <span class="tools pull-right">
                <a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <table class="form">
                <tr>
                    <td id="titleTag" class="formTitle">申请单位<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="ApplyCompanyName" type="text" disabled="disabled" class="form-control" isvalid="yes" checkexpession="NotNull" value="@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptName" />
                        <input id="ApplyCompanyCode" type="hidden" class="form-control" isvalid="yes" checkexpession="NotNull" value="@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptCode" />
                        <input id="ApplyCompanyId" type="hidden" class="form-control" isvalid="yes" checkexpession="NotNull" value="@ERCHTMS.Code.OperatorProvider.Provider.Current().DeptId" />
                    </td>
                    <td id="titleTag" class="formTitle">申请人<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="ApplyUserName" type="text" disabled="disabled" class="form-control" isvalid="yes" checkexpession="NotNull" value="@ERCHTMS.Code.OperatorProvider.Provider.Current().UserName" />
                        <input id="ApplyUserId" type="hidden" class="form-control" isvalid="yes" checkexpession="NotNull" value="@ERCHTMS.Code.OperatorProvider.Provider.Current().UserId" />
                    </td>
                </tr>
                <tr>
                    <td id="titleTag" class="formTitle">申请时间<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="ApplyDate" type="text" disabled="disabled" class="form-control" isvalid="yes" checkexpession="NotNull" value="@DateTime.Now.ToString("yyyy-MM-dd HH:mm")" />
                    </td>
                    <td id="titleTag" class="formTitle">申请编号<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="ApplyCode" type="text" disabled="disabled" class="form-control" />
                    </td>
                </tr>
                <tr id="tr_setupinfo">
                    <td class="formTitle">脚手架验收类型<font face="宋体">*</font></td>
                    <td class="formValue">
                        <div id="SetupType" type="select" class="ui-select" isvalid="yes" checkexpession="NotNull"></div>
                        @*<select id="SetupType" name="SetupType" class="form-control" isvalid="yes" checkexpession="NotNull">
                            <option value="">请选择</option>
                            <option value="0">6米以下脚手架验收申请</option>
                            <option value="1">6米以上脚手架验收申请</option>
                        </select>*@
                    </td>

                    <td class="formTitle"></td>
                    <td class="formValue"></td>
                </tr>
                <tr>
                    <td class="formTitle">使用单位类型<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input type="radio" id="SetupCompanyType1" name="SetupCompanyType" value="0" @(!ERCHTMS.Code.OperatorProvider.Provider.Current().RoleName.Contains("外包单位") ? "checked" : "") /><label for="SetupCompanyType1">单位内部</label>
                        <input type="radio" id="SetupCompanyType2" name="SetupCompanyType" value="1" @(ERCHTMS.Code.OperatorProvider.Provider.Current().RoleName.Contains("外包单位") ? "checked" : "") /><label for="SetupCompanyType2">外包单位</label>
                        <input type="hidden" id="SetupCompanyType" />
                    </td>
                    <td class="formTitle">
                        脚手架搭设信息<font face="宋体">*</font>
                    </td>
                    <td class="formValue">
                        <input type="text" id="SetupInfoCode" class="form-control" readonly onclick="selectScaffold()" isvalid="yes" checkexpession="NotNull" />
                        <input type="hidden" id="SetupInfoId" />
                        <input type="hidden" id="SetupPersons" />
                        <input type="hidden" id="SetupPersonIds" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">使用单位<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="SetupCompanyName" type="text" class="form-control" readonly onclick="selectCompany()" isvalid="yes" checkexpession="NotNull" />
                        <input id="SetupCompanyCode" type="hidden" />
                        <input id="SetupCompanyId" type="hidden" />
                    </td>
                    <td class="formTitle" id="td_title_projectname">工程名称<font face="宋体">*</font></td>
                    <td class="formValue" id="td_value_projectname">
                       <input id="OutProjectName" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" readonly placeholder="请选择工程" onclick="chooseProject();" />
                       <input id="OutProjectId" type="hidden" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">搭设单位<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="SetupCompanyName1" type="text" class="form-control" readonly onclick="selectCompany1()" isvalid="yes" checkexpession="NotNull" />
                        <input id="SetupCompanyCode1" type="hidden" />
                        <input id="SetupCompanyId1" type="hidden" />
                    </td>
                    <td class="formTitle">专业类别<font face="宋体">*</font></td>
                    <td class="formValue">
                       @*  <div id="SpecialtyType" type="select" class="ui-select" isvalid="yes" checkexpession="NotNull"></div>*@
                        <select id="SpecialtyType" name="SpecialtyType" class="form-control" isvalid="yes" checkexpession="NotNull">
                            <option value="">请选择</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">申请搭设时间<font face="宋体">*</font></td>
                    <td class="formValue">
                        <div style="float:left;width:48%;">
                            <input id="SetupStartDate" type="text" class="form-control input-wdatepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm', maxDate: '#F{$dp.$D(\'SetupEndDate\')}' })" isvalid="yes" checkexpession="NotNull" />
                        </div>
                        <div style="float:left;width:4%;text-align:center;line-height:28px">
                            -
                        </div>
                        <div style="float:left;width:48%">
                            <input id="SetupEndDate" type="text" class="form-control input-wdatepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm', minDate: '#F{$dp.$D(\'SetupStartDate\')}' })" isvalid="yes" checkexpession="NotNull" />
                        </div>
                    </td>
                    <td class="formTitle">实际搭设时间<font face="宋体">*</font></td>
                    <td class="formValue">
                        <div style="float:left;width:48%;">
                            <input id="ActSetupStartDate" type="text" class="form-control input-wdatepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm', maxDate: '#F{$dp.$D(\'ActSetupEndDate\')}' })" isvalid="yes" checkexpession="NotNull" />
                        </div>
                        <div style="float:left;width:4%;text-align:center;line-height:28px">
                            -
                        </div>
                        <div style="float:left;width:48%">
                            <input id="ActSetupEndDate" type="text" class="form-control input-wdatepicker" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm', minDate: '#F{$dp.$D(\'ActSetupStartDate\')}' })" isvalid="yes" checkexpession="NotNull" />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">搭设地点<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="SetupAddress" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" maxlength="100" />
                    </td>
                    <td class="formTitle">搭设负责人/监护人<font face="宋体">*</font></td>
                    <td class="formValue">
                        <input id="SetupChargePerson" type="text" class="form-control" isvalid="yes" checkexpession="NotNull" maxlength="50" onclick='selectUser({ deptId: "", checkMode: 0, mode: 0, winObject: window.document.body, domId: "SetupChargePerson,,SetupChargePersonIds", userIds: "SetupChargePersonIds" });' readonly/>
                        <input id="SetupChargePersonIds" type="hidden" />
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">抄送人</td>
                    <td class="formValue" style="display:flex">
                        <input id="CopyUserNames" type="text" class="form-control" readonly onclick='selectUser({ deptId: "", checkMode: 1, mode: 0, winObject: window.document.body, domId: "CopyUserNames,,CopyUserIds", userIds: "CopyUserIds" });' />
                        <input type="hidden" id="CopyUserIds" value="" />
                        <a id="btn_more" class="btn btn-primary" style="margin-left:5px;padding:0px 6px;height:28px;line-height:28px;" href="javascript:showmore();"><i class="fa fa-check"></i>&nbsp;更&nbsp;&nbsp;多</a>
                    </td>
                </tr>
                <tr>

                    <td class="formTitle">脚手架用途<font face="宋体">*</font></td>
                    <td class="formValue" colspan="3">
                        <textarea id="Purpose" class="form-control" rows="5" isvalid="yes" checkexpession="NotNull" maxlength="1000"></textarea>
                    </td>
                </tr>

                <tr>
                    <td class="formTitle">架体规格及形式<font face="宋体">*</font></td>
                    <td id="gridPanel" class="formValue" colspan="3">
                        <table id="ScaffoldSpec"></table>
                    </td>
                </tr>
                <tr>
                    <td class="formTitle">脚手架参数</td>
                    <td class="formValue" colspan="3">
                        <textarea id="Parameter" class="form-control" rows="5" maxlength="1000"></textarea>
                    </td>
                </tr>

            </table>
        </div>
    </div>

    <div id="safetyMeasure" class="panel panel-default">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;验收项目</strong>
            <span class="tools pull-right">
                <a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <table id="gridMeasure"></table>
        </div>
        <table class="form">
            <tr>
                <td class="formTitle" style="text-align:left;padding-left:20px;font-weight:bold;color:red;">验收照片</td>
            </tr>
            <tr>
                <td class="formValue">
                    <div class="ibox">
                        <div id="uploader_accept" class="uploader" style="border: 1px solid #ccc; margin-top: 10px; min-height: 100px; margin-bottom: 10px;">
                            <div class="queueList">
                                <div id="dndArea" class="placeholder">
                                    <div class="filePicker" style="margin-left: 25px; margin-top: 10px;"></div>
                                </div>
                            </div>
                            <div class="statusBar" style="display: none;">
                                <div class="progress">
                                    <span class="text">0%</span>
                                    <span class="percentage"></span>
                                </div>
                                <div class="info"></div>
                            </div>
                        </div>

                    </div>
                </td>
            </tr>
        </table>
    </div>

    <div id="panel_audit" class="panel panel-default">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;审核信息</strong>
            <span class="tools pull-right">
                <a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <div style="margin-top: 5px; margin-right: 30px;">
                <table class="form">
                    <tr>
                        <td class="formTitle">审核部门<font face="宋体">*</font></td>
                        <td class="formValue">
                            <input id="AuditDeptName" type="text" class="form-control" checkexpession="NotNull" disabled="disabled" />
                        </td>
                        <td class="formTitle">审核人<font face="宋体">*</font></td>
                        <td class="formValue">
                            <input id="AuditUserName" type="text" class="form-control" checkexpession="NotNull" disabled="disabled" />
                            <input type="hidden" id="AuditUserId" />
                            <input type="hidden" id="AuditDeptId" />
                            <input type="hidden" id="AuditDeptCode" />
                            <input type="hidden" id="ScaffoldId" />
                        </td>
                        <td class="formTitle">审核时间<font face="宋体">*</font></td>
                        <td class="formValue">
                            <input id="AuditDate" type="text" class="form-control" onfocus="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm:ss' })" value="@DateTime.Now.ToString("yyyy-MM-dd HH:mm:00")" disabled="disabled" checkexpession="NotNull" />
                        </td>
                    </tr>
                    <tr>
                        <td class="formTitle">审核结果<font face="宋体">*</font></td>
                        <td class="formValue" colspan="5">
                            <div class="radio-inline">
                                <label>
                                    <input type="radio" name="AuditState" id="AuditState1" value="1" onclick="auditCheck(this, 0)"/>同意
                                </label>
                            </div>
                            <div class="radio-inline">
                                <label>
                                    <input type="radio" name="AuditState" id="AuditState2" value="0" onclick="auditCheck(this, 0)"/>不同意
                                </label>
                            </div>
                        </td>
                        <td class="formTitle">签名<font face="宋体">*</font></td>
                        <td class="formValue">
                            <img id="AuditSignImg" style="height: 50px;" />
                        </td> 
                    </tr>
                    <tr>
                        <td class="formTitle">审核意见</td>
                        <td class="formValue" colspan="5">
                            <textarea id="AuditRemark" name="AuditRemark" class="form-control" maxlength="1000"></textarea>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div id="panel_auditrecord" class="panel panel-default">
        <div class="panel-heading">
            <strong>&nbsp;&nbsp;审核记录</strong>
            <span class="tools pull-right">
                <a class="fa fa-chevron-down" title="展开/收起"></a>
            </span>
        </div>
        <div class="panel-body">
            <table id="ScaffoldAudit"></table>
        </div>
    </div>

</div>

<div class="form-button" style=" top: 40px; text-align: left; padding-left: 20px; position: fixed; bottom: auto; z-index: 1000;">
    <div style="float:left;">
        <a id="btn_Export" class="btn btn-primary" style="background-color: #2e99d4; border-color: #2e99d4; " onclick="ExportDoc()"><i class="fa fa-mail-forward"></i>&nbsp;导&nbsp;&nbsp;出</a>
        &nbsp; &nbsp;
        <a id="btn_Save" class="btn btn-primary" style="background-color: #2e99d4; border-color: #2e99d4; "><i class="fa fa-check"></i>&nbsp;保&nbsp;&nbsp;存</a>
        &nbsp; &nbsp;
        <a id="btn_Submit" class="btn btn-primary" style="background-color: #2e99d4; border-color: #2e99d4; "><i class="fa fa-mail-forward"></i>&nbsp;提&nbsp;&nbsp;交</a>
        &nbsp; &nbsp;
        <a id="btn_AuditSave" class="btn btn-primary" style="background-color: #2e99d4; border-color: #2e99d4; " onclick="AuditSave()"><i class="fa fa-check"></i>&nbsp;保&nbsp;&nbsp;存</a>
        &nbsp; &nbsp;
        <a id="btn_Audit" class="btn btn-primary" style="background-color: #2e99d4; border-color: #2e99d4; " onclick="AuditSubmit()"><i class="fa fa-mail-forward"></i>&nbsp;提&nbsp;&nbsp;交</a>
        &nbsp; &nbsp;
        <a id="btn_Transfer" class="btn btn-primary" style="background-color: #2e99d4; border-color: #2e99d4; "><i class="fa fa-mail-forward"></i>&nbsp;审&nbsp;&nbsp;批&nbsp;&nbsp;转&nbsp;&nbsp;交</a>
        &nbsp; &nbsp;
    </div>
    <!--申请类型-->
    <input type="hidden" id="ScaffoldType" />
    <!--作业区域-->
    <input type="hidden" id="WorkArea" />
    <input type="hidden" id="WorkAreaCode" />
</div>

<div class="modal" id="QdModal">
    <div class="modal-dialog" style="width: 300px; margin-top: 100px;">
        <div class="modal-content" style="text-align: center;">
            <div class="modal-header">
                <h5 id="modeltitle">抄送人员</h5>
            </div>
            <div class="modal-body" id="modalBody">
            </div>
            <div class="modal-footer">
                <button id="btnModal" type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
